<!DOCTYPE>
<html xmlns="http://www.w3.org/1999/xhtml">
<head width="915" height="516" notusetoolbar="1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="msapplication-tap-highlight" content="no">


    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">


    <!--<meta http-equiv="pragma" content="no-cache">-->
    <!--<meta http-equiv="cache-control" content="no-cache">-->
    <!--<meta http-equiv="expires" content="0">-->
    <title>正在视频通话</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css"/>    <!--通用-->
    <link rel="stylesheet" type="text/css" href="css/common.css"/>    <!--通用-->
    <link rel="stylesheet" type="text/css" href="css/video.css"/>    <!--视频-->
    <link rel="stylesheet" type="text/css" href="css/powerange.css"/>    <!--音量-->
    <link rel="stylesheet" type="text/css" href="css/layer.css">  <!-- 弹窗-->
    <script type="text/javascript" src="js/jQuery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/iscroll-5.1.3.min.js"></script>    <!--滚动条-->
    <script type="text/javascript" src="js/powerange.min.js"></script>        <!--音量-->
    <script type="text/javascript" src="js/my_layer.js"></script> <!--弹窗-->
    <script type="text/javascript" src="js/application.js"></script>
    <script type="text/javascript" src="js/xss.min.js"></script>
    <script type="text/javascript" src="js/base64.min.js"></script>
    <style>
        video {
            /*object-fit:fill;*/
            object-fit: cover;
        }
    </style>
    <script>
        //左侧视频的高度：宽/高=1.333333
        function autoHeight() {
            var h100 = $(".vdo_l").height();	//100%
            var h = h100 / 4 - 1;					//25%-1px，获取单个视频的高度
            var w = h * 1.33333;				//视频的宽度
            $(".vdo_lD").css({width: w, height: h});	//左侧视频的宽 高
            $(".vdo_r").css({left: w + 1});
            $(".vdo_l").css({width: w})//右侧视频定位左侧距离
        }

        $(function () {
            autoHeight();
            $(window).resize(autoHeight);
        })
        var myscroll3 = null, myScroll = null;
        //控制音量

        $(function () {
//音量
            var vert = document.querySelector('.js-vertical');
            var $btn_mute = $('.vdo_btn_mute')
            $('.volume_con').hover(function () {
                if (this.querySelector('.vdo_btn_mute').classList.contains('on')) {
                    return;
                }
                $('.volume_div').show()
                if (!initVert) {
                    initVert = new Powerange(vert, {start: 80, vertical: true});
                    var option = initVert.options;
                    var handel = initVert.handle;
                    step = (initVert.slider.offsetHeight - handel.offsetHeight) / (option.max - option.min);
                }
            }, function () {
                $('.volume_div').hide()
            })
            $('.volume_plus').bind('click', function () {//增加声音
                initData.setInitAutio = false
                var value = isNaN(vert.value) ? 0 : parseInt(vert.value)
                var option = initVert.options;
//                var value=parseInt(vert.value)
                if (value == option.max) return;
                var slider = initVert.slider;
                var handel = initVert.handle;
                var obtm = slider.querySelector('.range-quantity')
                var step = (initVert.slider.offsetHeight - handel.offsetHeight) / (option.max - option.min);
                var newVal = value + (option.step || 5)
                if (newVal >= option.max) {
                    newVal = option.max;
                }
                vert.value = newVal;
                handel.style.bottom = newVal * step + 'px';
                obtm.style.height = newVal * step + 'px';
                var audioInputId = initData.audioInputId
                var volume = newVal
                if (audioInputId) {
                    var parm = {action: "volume", audioInputId: audioInputId, volumePercent: volume}
                    ControlAudio(parm).then(function (data) {
                    })
                }
                if (volume <= step) {
                    $btn_mute.removeClass('on')
                }
            })

            $('.volume_minus').bind('click', function () {//减少声音
                initData.setInitAutio = false
                vert.value ? vert.value : 0
                var option = initVert.options;
                var value = parseInt(vert.value)
                if (value == option.min) return;
                var slider = initVert.slider;
                var handel = initVert.handle;
                var obtm = slider.querySelector('.range-quantity')
                var newVal = value - (option.step || 5)
                var step = (initVert.slider.offsetHeight - handel.offsetHeight) / (option.max - option.min);
                if (newVal <= option.min) {
                    newVal = option.min;
                }
                vert.value = newVal;
                handel.style.bottom = newVal * step + 'px';
                obtm.style.height = newVal * step + 'px'
                var audioInputId = initData.audioInputId
                var volume = newVal
                if (audioInputId) {
                    var parm = {action: "volume", audioInputId: audioInputId, volumePercent: volume}
                    ControlAudio(parm).then(function (data) {
                    })
                }
                if (volume == 0) {
                    $btn_mute.addClass('on')
                } else if (volume <= step) {
                    $btn_mute.removeClass('on')
                }

            })
            vert.onchange = function () {
                if (initData.setInitAutio) {
                    initData.setInitAutio = false
                    return;
                }
                var clum = parseFloat(this.value);
                var audioInputId = initData.audioInputId
                var volume = clum
                if (audioInputId) {
                    var parm = {action: "volume", audioInputId: audioInputId, volumePercent: volume}
                    ControlAudio(parm).then(function (data) {
                    })
                }
                if (volume == 0) {
                    $btn_mute.addClass('on')
                } else if (volume <= step) {
                    $btn_mute.removeClass('on')
                }
            }
            //右侧成员列表 显示/隐藏
            $(".vdo_btn_member").click(function (e) {
                var action = 0
                if (!this.classList.contains('on')) {
                    $(".vdo_rList").css({opacity: "1", right: "0"}).show()
                    $(this).addClass("on");
                    action = 1
                } else {
                    $(".vdo_rList").css({opacity: "0", right: "-246px"}).hide()
                    $(this).removeClass("on");
                }
                if (initData.isXP) {
                    var parm = {isShow: action}
                    ShowConfMemberList(parm)
                }


                myscroll3.refresh();
                mystopPropagation(e)
            })
            //主持人-右侧参会人员tab切换
            $(".vdo_rL_tTab a").each(function (index) {
                $(this).click(function (e) {
                    //右侧 默认（背景图标）
                    $(".vdo_rL_tCon").addClass("disN")
                    $(".vdo_rL_tCon:eq(" + index + ")").removeClass("disN")
                    $(".vdo_rL_tTab a").removeClass("on")
                    $(this).addClass("on")
                    myscroll3.refresh();
                    mystopPropagation(e)
                })
            })
            //主持人-点击右侧按钮
            //麦克风
            $(".vdo_rL_aMute").click(function () {
                if ($(this).is('.on')) {
                    $(this).removeClass('on');
                    $(this).attr("title", "点击禁言");
                } else {
                    $(this).addClass('on');
                    $(this).attr("title", "恢复通话");
                }
            })
            //摄像头
            $(".vdo_rL_aVideo").click(function () {
                if ($(this).is('.on')) {
                    $(this).removeClass('on');
                    $(this).attr("title", "关闭视频");
                } else {
                    $(this).addClass('on');
                    $(this).attr("title", "打开视频");
                }
            })

            //调节麦克风
            $(".vdo_btn_mic").click(function () {
                initData.setInitAutio = false
                if (this.classList.contains('no')) {
                    return
                }
                var $ele = $(this)
                var redo = $ele.data('redo');
                if (redo) {
                    return
                } else {
                    $ele.data('redo', true)
                }
                closeOrOpen(this)
                var audioInputId = initData.audioInputId
                if (audioInputId) {
                    var isOff = false
                    if (this.classList.contains('on')) {
                        var parm = {action: "stop", audioInputId: audioInputId}
                        isOff = true
                        this.title = '打开麦克风'
                    } else {
                        var parm = {action: "start", audioInputId: audioInputId}
                        this.title = '关闭麦克风'
                    }
                    ControlAudio(parm).then(function (data) {
                        if (data == 0) {
                            $ele.data('redo', false);
                            if (isOff) {
//                                $('.mySelf').parents('.vdo_lD').find('.vdo_l_bac').hide()
                                $('.mySelf').find('.vdo_l_mute ').show()
                            } else {
                                $('.mySelf').find('.vdo_l_mute ').hide()
                            }
                        }
                    })
                }
            })
            // 关闭视频
            $(".vdo_btn_camera").click(function () {
                if (this.classList.contains('no')) {
                    return
                }
                var $ele = $(this)
                var redo = $ele.data('redo');
                if (redo) {
                    return
                } else {
                    $ele.data('redo', true)
                }
                closeOrOpen(this);
                var isOff = false;
                if (this.classList.contains('on')) {
                    var parm = {
                        action: "stop",
                        wnd: initData.ownerWnd,
                        videoId: initData.videoId,
                        sessionId: initData.sessionId
                    }
                    isOff = true
                    type = 1
                    this.title = '打开摄像头'
                } else {
                    var parm = {
                        action: "start",
                        wnd: initData.ownerWnd,
                        videoId: initData.videoId,
                        sessionId: initData.sessionId
                    }
                    isOff = false
                    type = 0
                    this.title = '关闭摄像头'
                }

                ControlVideo(parm).then(function (data) {
                    if (data == 0) {
                        var $tem = $(".vdo_btn_camera")
                        $tem.data('redo', false);
                        var $mySelf = $('.mySelf')
                        if (isOff) {
                            $mySelf.find('.vdo_l_bac').show();
                            $mySelf.find('video').hide();
                        } else {
                            $mySelf.find('.vdo_l_bac').hide()
                            $mySelf.find('video').show();
                        }
                    }
                })
            })
            // 调节音量
            $(".vdo_btn_mute").click(function () {
                initData.setInitAutio = false;
                closeOrOpen(this)
                var audioInputId = initData.audioInputId
                var vert = document.querySelector('.js-vertical');
                if (this.classList.contains('on')) {//静音
                    this.setAttribute('title', '恢复扬声器')
                    if (audioInputId) {
                        var parm = {action: "volume", audioInputId: audioInputId, volumePercent: 0}
                        ControlAudio(parm).then(function (data) {
                        })

                        // var slider = initVert.slider;
                        // var handel = initVert.handle;
                        // var obtm = slider.querySelector('.range-quantity')
                        // vert.value = 0;
                        // handel.style.bottom = 0 + 'px';
                        // obtm.style.height = 0 + 'px';

                    }
                    // vert.value = 0;
                } else {
                    this.setAttribute('title', '点击静音')
                    if (audioInputId) {

                        var parm = {action: "volume", audioInputId: audioInputId, volumePercent: parseInt(vert.value)}
                        ControlAudio(parm).then(function (data) {

                        })
                    }
                }

            })
            //设置
            $(".vdo_btn_set").click(function (e) {
                $(".vdo_set").toggle();
                var e = e || window.event; //浏览器兼容性
                e.stopPropagation()
            })
            $(document).bind('click', function (e) {
                $(".vdo_set").hide();
                var e = e || window.event; //浏览器兼容性
                var elem = e.target || e.srcElement;
                while (elem) {
                    if (elem.id && elem.id == 'vdo_btn_lack') {
                        return;
                    }
                    if (elem.id && elem.id == 'vdo_btn_lD') {
                        return;
                    }
                    if (elem.id && elem.id == 'vdo_btn_camera') {
                        return;
                    }
                    if (elem.id && elem.id == 'vdo_btn_mute') {
                        return;
                    }
                    if (elem.id && elem.id == 'vdo_btn_mic') {
                        return;
                    }
                    elem = elem.parentNode;
                }
                var lackH = $(".vdo_btn_lD").outerHeight();
                $(".vdo_btn_lD").css({
                    opacity: "0",
                    bottom: -lackH
                })
            });
//点击显示设备情况
            var lackH = $(".vdo_btn_lD").outerHeight();	//获取向上滑动弹出框动画的高度
            $(".vdo_btn_l").hover(function (e) {
                if (initData.isXP) {
                    return;
                }
                $(".vdo_btn_lD").css({opacity: "1", bottom: "38px"})
                e.stopPropagation()
            }, function (e) {
                $(".vdo_btn_lD").css({opacity: "0", bottom: -lackH})
                e.stopPropagation()
            })

//更改状态
            function closeOrOpen(ele) {
                if (!ele.classList.contains('on')) {//
                    ele.classList.add('on')
                } else {
                    ele.classList.remove('on')
                }
            }

            // 视频会议主持人队成员处理
            $('.vdo_rL_tabC  #vdo_connecting').delegate('i', 'click', function (e) {
                mystopPropagation(e)
                if (initData.flag == 'qun_videomeetingcaller') {
                    if (this.classList.contains('no')) return;
                    var $ele = $(this);
                    if ($ele.data('redo')) {
                        return;
                    } else {
                        $ele.data('redo', true)
                    }

                    var type = this.dataset.type;
                    var $li = $ele.parents('li')
                    var uniid = $li.attr('uniid');

                    var isOn = this.classList.contains('on');
                    this.classList.toggle('on');
                    var action = isOn ? 'start' : 'stop',
                        ctrType = '';
                    if (type === '1') {
                        ctrType = 'kick'

                    } else if (type === '2') {
                        ctrType = 'audio';
                        if (isOn) {
                            if (audioRoleList.length == 15) {
                                $('#vdo_connecting .vdo_rL_iMute.on').addClass('no');
                            }
                        } else {
                            if (audioRoleList.length == 16) {
                                $('#vdo_connecting .vdo_rL_iMute.on').removeClass('no');
                            }
                        }


                    } else if (type === '3') {
                        ctrType = 'video'
                        if (isOn) {
                            if (videoRoleList.length == 4) {
                                $('#vdo_connecting .vdo_rL_iVideo.on').addClass('no');
                            }
                        } else {
                            if (videoRoleList.length == 5) {
                                $('#vdo_connecting .vdo_rL_iMute.on').removeClass('no');
                            }
                        }
                    }

                    var parm = {action: action, ctrlType: ctrType, userUniId: uniid, sessionId: initData.sessionId}
                    ControlConfMember(parm).then(function (status) {
                        $ele.data('redo', false);

                        if (status == 0) {
                            // var $vdo_out = $('.vdo_out[uniid="' + uniid + '"]')
                            // if (type === '2') {
                            //     if (isOn) {
                            //         $vdo_out.find('.vdo_l_mute').hide();
                            //     } else {
                            //         $vdo_out.find('.vdo_l_mute').show();
                            //     }
                            // } else if (type === '3') {
                            //     if (isOn) {
                            //         $vdo_out.find('.vdo_l_bac').hide()
                            //     } else {
                            //         $vdo_out.find('.vdo_l_bac').show();
                            //         $vdo_out.find('.vdo_tip').html('语音中');
                            //     }
                            // } else
                            // if (type === '1') {
                            //     var curitem = hasJoinList[uniid]
                            //     if (curitem) {
                            //         hasJoinList[uniid] = null;
                            //     }
                            // }

                        }
                    })
                    if (uniid == initData.curUserUniID) {//主持人
                        var $Out = $('.vdo_out[uniid="' + uniid + '"]');
                        var $mute = $('#vdo_btn_mute')
                        var videoStatus={}
                        if (type == 3) {
                            if (!isOn) {
                                $li.find('.vdo_rL_iMute').addClass('on');
                                if (mainVideo == uniid) {

                                    if ($('.vdo_l .vdo_lD').length == 1) {
                                        $Out.hide()
                                    } else {
                                        // mainVideo='';
                                        $Out.remove()
                                    }

                                } else {
                                    $Out.parents('.vdo_lD').remove();
                                }
                                videoStatus={isLeaved:0,isStart:0,mediaOption:3,userUniID:uniid,peerWnd:initData.ownerWnd};
                                setVideoOrAudioAuthority(videoStatus)

                                if (mainVideo == uniid) setMainVideo();
                            } else {
                                var id = initData.userUniIdList.findIndex(function (item) {
                                    return item.userUniId == uniid
                                });
                                if (id > -1) {
                                    if ($Out.length == 0) {

                                        var curMember = initData.userUniIdList[id];
                                        var peerVideo = bindleftVideo(curMember);
                                        var $parent = peerVideo.parents('.vdo_lD')
                                        bindVideo(initData.ownerWnd, peerVideo[0]);
                                        if ($li.find('.vdo_rL_iMute').hasClass('on')) {
                                            $parent.find('.vdo_l_mute').show();
                                            $mute.addClass('on').attr('title', '恢复扬声器')
                                        } else {
                                            $parent.find('.vdo_l_mute').hide();
                                            $mute.removeClass('on').attr('title', '点击静音')
                                        }
                                    } else {
                                        $Out.show();
                                        if ($li.find('.vdo_rL_iMute').hasClass('on')) {
                                            $Out.find('.vdo_l_mute').show();
                                            $mute.addClass('on').attr('title', '恢复扬声器')
                                        } else {
                                            $Out.find('.vdo_l_mute').hide();
                                            $mute.removeClass('on').attr('title', '点击静音')
                                        }
                                    }
                                    videoStatus={isLeaved:0,isStart:1,mediaOption:2,userUniID:uniid,peerWnd:initData.ownerWnd};
                                    setVideoOrAudioAuthority(videoStatus)
                                }
                            }
                        } else if (type == 2) {

                            if (!isOn) {
                                $('#vdo_btn_mute').addClass('on');
                                if ($Out.length > 0) {
                                    $Out.find('.vdo_l_mute').show()
                                    $mute.addClass('on').attr('title', '恢复扬声器')
                                }
                                videoStatus={isLeaved:0,isStart:0,mediaOption:1,userUniID:uniid,peerWnd:initData.ownerWnd};
                                setVideoOrAudioAuthority(videoStatus)
                            } else {
                                $('#vdo_btn_mute').removeClass('on')
                                if ($Out.length > 0) {
                                    $Out.find('.vdo_l_mute').hide()
                                    $mute.removeClass('on').attr('title', '点击静音')
                                }
                                videoStatus={isLeaved:0,isStart:1,mediaOption:1,userUniID:uniid,peerWnd:initData.ownerWnd};
                                setVideoOrAudioAuthority(videoStatus)
                            }
                        }

                    }
                } else {
                    return;
                }
            });

            $('.vdo_rL_tabC  #vdo_notConnect').delegate('.vdo_rL_iReCalled', 'click', function (e) {
                if (initData.flag == 'qun_videomeetingcaller') {
                    var $ele = $(this);
                    if ($ele.data('redo')) {
                        return;
                    } else {
                        $ele.data('redo', true)
                    }
                    var $li = $ele.parents('li')
                    var uniid = $li.attr('uniid');

                    var parm = {
                        qunId: qunId,
                        userUniIdList: [uniid],
                        recordDomain: initData.recordDomain,
                        juFengId: confId,
                        passwd: initData.password
                    };
                    $li.find('.vdo_noReceive_tip').html('呼叫中');
                    $li.addClass('recalling');
                    InvateVideoMeetingMember(parm).then(function () {
                        $ele.data('redo', false);
                    })

                } else {
                    return;
                }
                mystopPropagation(e)
            });
            // 添加选人窗口
            $('.vdo_rL_tBtn').click(function (e) {
                if (canInverterCount > 0) {
                    var parm = {
                        fromCode: initData.code,
                        orgDomain: initData.orgDomain,
                        existUserList: initData.userUniIdList,
                        initdatas: initData,
                        option: {
                            maxLength: initData.vedioMeetingMaxNumOfPeople,
                            title: '视频会议邀请',
                            tipMsg: '视频会议人数上限为' + initData.vedioMeetingMaxNumOfPeople + '人'
                        }
                    }
                    SelectPeople(initData.id, parm)
                }
                mystopPropagation(e)
            })
        })
        //缺少设备 显示/隐藏
        $(function () {

        })
        //退出
        $(function () {
            //点击关闭按钮退出视频
            ReceiveIframeWebCall1('LxVideoConf')
            $(".vdo_btn_quit").click(function () {
                debugger;
                layOutMsgBOx();
            })

        })
        //邀请-弹出框
        $(function () {
            $(".vdo_iHint_close").click(function () {
                $(this).parents(".vdo_invite_hint").remove();
            })
            $(".vdo_invite_b a").click(function () {
                $(this).parents(".vdo_invite").remove();
            })
        })
        //设置
        $(function () {
            $(".vdo_set_close").click(function () {
                $(this).parents(".vdo_set").hide();
            })
        })
        //设置设备
        $(function () {
            document.onclick = function () {
                $(".vdo_drop_ModifyThe").removeClass("vdo_drop_aB")
                $(".vdo_drop_list").hide();
                $(".vdo_rList").css({opacity: "0", right: "-246px"}).hide()
                $(".vdo_btn_member").removeClass('on');
            };
            $('.vdo_set').click(function (event) {
                $('.vdo_drop_list').hide();
                $('.vdo_drop_aB').removeClass('vdo_drop_aB')
                var e = window.event || event;
                if (e.stopPropagation) {
                    e.stopPropagation();
                } else {
                    e.cancelBubble = true;
                }
            })
            $('.vdo_drop').click(function (event) {
                var $ele = $(this);
//                if ($ele.hasClass('vdo_drop_MNo')) {
//                    return
//                }
//                $('.vdo_drop_list').hide()
                $ele.find('.vdo_drop_list').toggle();
                $ele.find('.vdo_drop_ModifyThe ').toggleClass("vdo_drop_aB")
                var vdo_set = $ele.parents('.vdo_set_li').siblings()
                vdo_set.find('.vdo_drop_list').hide();
                vdo_set.find('.vdo_drop_aB').removeClass('vdo_drop_aB');
                var e = window.event || event;
                if (e.stopPropagation) {
                    e.stopPropagation();
                } else {
                    e.cancelBubble = true;
                }
            });
        })
        //滚动条
        $(function () {
            loaded();
        })

        function loaded() {
            var option = {
                probeType: 2,
                scrollbars: "custom",
                mouseWheel: true,
                bounce: false,
                interactiveScrollbars: true,
                shrinkScrollbars: 'scale',
                preventDefault: false
            };
            myScroll = new IScroll('#wrapper', option);
//            var myscroll2 = new IScroll('#wrapper2', option);
            myscroll3 = new IScroll('#wrapper3', option);
//            var myscroll4 = new IScroll('#wrapper4', option);
        }

    </script>
    <!--<script type="application/javascript" src="./js/videoConf.js"></script>-->
</head>

<body class="shadow">

<script>
    if (navigator.userAgent.indexOf('Mac OS X') > -1) {
        $('body').addClass('mac')
    } else {
        $('body').addClass('pc')
    }
</script>
<div class="out_box">

    <!--视频-->
    <div class="vdo_main">
        <div class="vdo_con">
            <div class="vdo_l" id="wrapper">
                <div class="scroll">
                    <div class="vdo_lD " onclick="changeVideo(this,event)" style="" id="vdo_tem">

                        <!--<div class="vdo_l_video">-->

                        <!--</div>-->
                        <div class="vdo_out">
                            <video src="" class="vdo_l_video" autoplay>

                            </video>
                            <div class="vdo_l_bac disN">
                                <div class="vdo_tip ">语音中</div>

                                <div class="vdo_lBg_btn"></div>

                            </div>
                            <i class="vdo_l_mute disN"></i>
                            <div class="vdo_lD_b">我</div>
                            <div class="vdo_r_callOutD">正在呼叫</div>

                        </div>
                    </div>
                </div>
                <div class="vdo_l_wait_member" style="display: none">
                    <span>等待成员进入会议...</span>
                </div>
            </div>
            <div class="vdo_r">
                <!--<div class="vdo_r_callOut">-->
                <!--<div class="vdo_r_callOutD">正在呼叫…</div>-->
                <!--</div>-->
                <div class=" vdo_out">
                    <video class="vdo_r_callOut" autoplay>

                    </video>
                    <!--<div class="vdo_r_voC disN">-->
                    <!--<i class="vdo_r_voCBtn"></i>-->
                    <!--<p>语音中</p>-->
                    <!--</div>-->
                    <div class="vdo_l_bac disN">
                        <div class="vdo_tip ">语音中</div>
                        <div class="vdo_lBg_btn"></div>
                    </div>

                    <div class="vdo_r_t">
                        <h3 class="main_name"></h3>
                        <p class="main_branch"></p>
                    </div>
                    <i class="vdo_l_mute disN"></i>
                    <div class="vdo_r_callOutD">正在呼叫...</div>
                </div>


                <div class="vdo_rList disN" style="opacity: 1; right: 0px; display: none">
                    <div class="PA42 disN">
                        <div class="vdo_rL_tTit ">已加入(<span id="topconnectCount">0</span>)</div>
                    </div>
                    <div class="PA88">
                        <div class="vdo_rL_tBtn"><a href="javascript:;"><i></i><span
                                id="canInvert_count">可邀请0人</span></a></div>
                        <div class="vdo_rL_tTab">
                            <ul>
                                <li><a href="javascript:;" class="on">已接通(<span id="connectCount">0</span>)</a></li>
                                <li class="notConnectCount"><a href="javascript:;">未接通(<span
                                        id="notConnectCount">0</span>)</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="vdo_rL_tabC" id="wrapper3">
                        <div>
                            <div class="vdo_rL_tCon ">
                                <ul class="vdo_rL_list vdo_qun_call" id="vdo_connecting">
                                    <!--<li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iKick" title="断开"></i><i-->
                                    <!--class="vdo_rL_iMute" title="音频已被开启"></i><i-->
                                    <!--class="vdo_rL_iVideo" title="视频已被开启"></i><i class="vdo_rL_iReCalled"-->
                                    <!--title="重拨"></i><span-->
                                    <!--class="vdo_noReceive_tip">已挂断</span></span></span><img-->
                                    <!--src="images/card_icon.png">-->
                                    <!--<p>莉莉(主持人)</p></li>-->
                                </ul>
                            </div>
                            <div class="vdo_rL_tCon disN">
                                <ul class="vdo_rL_list" id="vdo_notConnect">
                                    <!--<li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iKick" title="断开"></i><i-->
                                    <!--class="vdo_rL_iMute" title="音频已被开启"></i><i-->
                                    <!--class="vdo_rL_iVideo" title="视频已被开启"></i><i class="vdo_rL_iReCalled"-->
                                    <!--title="重拨"></i><span-->
                                    <!--class="vdo_noReceive_tip">已挂断</span></span></span><img-->
                                    <!--src="images/card_icon.png">-->
                                    <!--<p>莉莉(主持人)</p></li>-->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="vdo_btn">
            <div class="vdo_btn_c">
                <a href="javascript:;" class="vdo_btn_mic " id="vdo_btn_mic" title="关闭麦克风"><i></i></a>
                <a href="javascript:;" class="vdo_btn_camera " id="vdo_btn_camera" title="关闭摄像头"><i></i></a>
                <span class="volume_con">
                    <a href="javascript:;" class="vdo_btn_mute " id="vdo_btn_mute" title="点击静音"><i></i></a>
        <div class="volume_div">
            <div class="vdo_btn_muteIpt"><em class="volume_btn volume_plus"></em>
                <div class="slider-wrapper vertical-wrapper"><input type="text" class="js-vertical"/></div>
                <em class="volume_btn volume_minus"></em>
            </div>
        </div>
                    </span>
                <!--<a href="javascript:;" class="vdo_btn_set disN" title="设置"><i></i></a>-->
                <a href="javascript:;" class="vdo_btn_member " style="" title="会议管理">
                    <i></i><em><span id="vdo_btn_Count">0</span> / <span id="vdo_btn_AllCount">0</span></em>
                </a>
            </div>
            <div class="vdo_btn_r"><span class="vdo_time" id="vdo_time">00:00</span><a href="javascript:;"
                                                                                       class="vdo_btn_quit"><i></i>退出</a>
            </div>
            <div class="vdo_btn_l disN">
                <a href="javascript:;" class="vdo_btn_lack" id="vdo_btn_lack"><i></i>缺少设备</a>
                <div class="vdo_btn_lD" id="vdo_btn_lD"><h4>未检测到摄像头、话筒、扬声器</h4>
                    <p>请确定设备已插入并安装最新驱动，或其他程序正在占用此设备。</p></div>
            </div>
        </div>
    </div>

</div>
<audio src="" id="audio" autoplay></audio>
</body>
</html>

<script>
    var initData = null, confId = 0, senderId = -1, type = 0, imgList = {}, settinginfos = {}, callType = 1,
        error = {Jufeng: false},
        connectList = [],//已通列表
        notConnectList = [],//未接通列表
        video_role = 0,// 0 视频通话 主叫 1视频通话被叫 2 视频会议发起者 3 视频会议参与者
        isconnect = false,//是否接通
        timer = null,//计时30秒如果超过30秒则自动挂断
        timer_video = null,//记录视频通话时间null
        exitVideoIsManual = false,//退出视频是否是主动退出的
        qunId = 0, //视频会议记录群的ID
        imgList = [],
        imgId = -1,
        maxInvertCount = 15,
        canInverterCount = 0,
        meetingTitle = '蓝信视频会议',
        mainVideo = '',//记录主窗口
        videoCount = 0,//记录已接入视频的人数
        videoRoleList = [],//记录已接入视频的人员信息
        audioCount = 0,//记录已接入音频的人数
        audioRoleList = [],//记录已接入音频的人员信息
        initVert = null, step = 5; //记录音频

    //callType 记录会话的状态
    $(function () {
        var parm = {};
        navigator.getUserMedia = navigator.webkitGetUserMedia || navigator.getUserMedia
        try {
            window.lxpc.exebusinessaction('extend', 'InitFinished', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                if (status == 0) {

                    var tmpdata = JSON.parse(jsondata);
                    initData = JSON.parse(jsondata);
                    console.log('初始化数据================================')
                    console.log(jsondata)

                    var peerDialogId = tmpdata['dialogId']
                    var nflag = tmpdata['flag']
                    var tmpparm = {userUniId: peerDialogId};
                    if (nflag == 'qun_videomeetingcaller' || nflag == 'to_be_videomeetingcalled') {//发起群会议
                        maxInvertCount = initData.vedioMeetingMaxNumOfPeople;
                        if (!initData.curUserUniID) {
                            initData.curUserUniID = initData.toUserUniId;
                        }
                        qunVideoConf(nflag)
                        bindJoinMember()
                        initSettingforMetting(nflag)
                    } else {
                        if (nflag == 'videocaller') {//个人发起
                            replayAudioTip(1)//语音提示正在呼叫
                            video_role = 0
//                            VideoCall(tmpparm)
//                            openMedia();
                            loadJuFeng().then(function (data) {
                                VideoCall(tmpparm);
                                openMedia(data)
                            })
                            timer = setTimeout(function () {
                                if (!initData.getSuccess) {
                                    $('.vdo_r .vdo_r_callOutD').html('对方正忙,请稍后再拨...')
                                    setTimeout(function () {
                                        TerminateVideoConf()
                                    }, 3000)

                                    if (video_role == 0) {
                                    }
                                    replayAudioTip(3)
                                    setTimeout(function () {
                                        replayAudioTip(0)
                                    }, 1000)


                                }
                            }, 30000)

                        } else {//个人被叫
                            video_role = 1
                            if (initData.callType == 1) {//正常接听
                                callType = 1
                            } else if (initData.callType == 2) {//语音接听
                                callType = 2
                            }
                            loadJuFeng().then(function (data) {
                                var parm = {userUniId: peerDialogId, opCode: '0', callType: 1}
                                ResponseVideoCall(parm)//响应被叫
                                openMedia(data);
                            })
                            if (callType === 2) {
                                var myvideo = $('.vdo_l .vdo_out');
                                myvideo.find('.vdo_l_bac').show()
                                myvideo.find('video').hide()
                                $('.vdo_r_callOutD').html('视频连接中...')
                                $('.vdo_btn_camera').addClass('on').attr('title', '打开摄像头')
                            }

                        }
                        initSetting(nflag);

                    }
                    //video call发起
                } else {
                    console.log(status)
                }
            })
        } catch (e) {
            e.message
        }
//注册回调
//接受视频和音频
//        var oplay = document.getElementsByClassName('vdo_l_video')[0]
//        var oplayX = document.getElementsByClassName('vdo_r_callOut')[0];
        ReceiveVideoCallResult();
//        TitleTools();
    })

    //发起视频通话
    function VideoCall(tmpparm) {
        window.lxpc.exebusinessaction('VideoConf', 'VideoCall', '0', JSON.stringify(tmpparm), 0, function (status, jsondata, targ) {
            if (status == 0) {
                console.log(jsondata)
                console.log('发起会议===============================')
                var data = JSON.parse(jsondata)
                initData.getSuccess = true;
                //0=接受；1=拒绝；2=占线；3=超时;4=不在线;5=不支持（PMC关闭）；6=版本不支持
                if (data.opCode == 0) {
                    isconnect = true;
                    var parm = {sendUserUniId: initData.curUserUniID, recUserUniId: initData.dialogId}
//打开麦克风
                    window.lxpc.exebusinessaction('VideoConf', 'VideoMtcCall', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                        if (status == 0) {
                        }
                        else {
                            console.log(status)
                        }
                    })

                } else {
                    var tip = ''
                    switch (data.opCode) {
                        case '1':
                            tip = '对方已拒绝'
                            break;
                        case '2':
                            tip = '对方占线'
                            break;
                        case '3':
                            tip = '请求超时'
                            break;
                        case '4':
                            tip = '对方不在线'
                            break;
                        case '5':
                            tip = '设备不支持'
                            break;
                        case '6':
                            tip = '版本不支持'
                            break;
                        default:
                            tip = '未知错误'
                            break;
                    }
                    if (initData.isXP) {
                        setTimeout(function () {
                            TerminateVideoConf();
                        }, 2000)
                    } else {
                        my_layer({message: tip}, 'warn', function () {
                            setTimeout(function () {
                                TerminateVideoConf();
                            }, 2000)

                        })
                    }

                    if (data.opCode == '2') {
//                        var message = Base64.encode('对方正在通话中');
                        replayAudioTip(0)//语音提示
                    } else if (data.opCode == '4' || data.opCode == '5' || data.opCode == '6') {
//                        var message = Base64.encode('对方无法使用视频通话');
                    } else if (data.opCode == '1') {
                        clearTimeout(timer)
//                        var message = Base64.encode('对方正忙，无法接听');
                    } else if (data.opCode != '1' && data.opCode != '3') {
//                        var message = Base64.encode('对方无法使用视频通话');
                    }

                    $('.vdo_r_callOutD').html(tip)
                }
            }
            else {
                console.log(status)
            }
        })
    }

    //响应被叫
    function ResponseVideoCall(tmpparm, opCode) {
        console.log(tmpparm)
        console.log('ResponseVideoCall============----------------------------')
        window.lxpc.exebusinessaction('VideoConf', 'ResponseVideoCall', '0', JSON.stringify(tmpparm), 0, function (status, jsondata, targ) {
            if (status == 0) {
                console.log('响应------------------')
                console.log(jsondata)
                if (opCode == 1) {
                    window.lxpc.closewnd();
                }
            }
            else {
                console.log(status)
            }
        })
    }

    function playMedia(jsondata) {
//        if (type == 1) {//语音接听
//            var $filter = $('.mySelf');
//            $filter.find('video').hide();
//            $filter.find('.vdo_l_bac').show();
//        }
//        else {
        window.lxpc.exebusinessaction('VideoConf', 'OpenVideo', '0', jsondata, 0, function (status, jsondata, targ) {
            if (status == 0) {
                if (callType == 2) {
                    var parm = {
                        action: "stop",
                        wnd: initData.ownerWnd,
                        videoId: initData.videoId,
                        sessionId: initData.sessionId || 0
                    }
                    ControlVideo(parm).then(function (data) {
                    })
                }
            }
            else {
                console.log(status)
            }
        })
//        }
        //open audio
        window.lxpc.exebusinessaction('VideoConf', 'OpenAudio', '0', jsondata, 0, function (status, jsondata, targ) {
            if (status == 0) {
            }
            else {
                console.log(status)
            }
        })
//
//        var parm = {sendUserUniId: initData.curUserUniID, recUserUniId: initData.dialogId}
////打开麦克风
//        window.lxpc.exebusinessaction('VideoConf', 'VideoMtcCall', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
//
//            if (status == 0) {
//
//            }
//            else {
//                console.log(status)
//            }
//        })
    }

    //群会议操作
    function qunVideoConf(ngflag) {
        $('.vdo_btn_member').show();

        if (ngflag == 'qun_videomeetingcaller') {//主叫
            video_role = 2
            replayAudioTip(1)
            loadJuFeng().then(function (jsondata) {
                var data = JSON.parse(jsondata);
                //验证视频会议
                MtcCreateVideoMeeting();
                var data = JSON.parse(jsondata);
                initData.ownerWnd = data.ownerWnd;
                // initData.peerWnd = data.peerWnd;
                initData.videoId = (data.cameraInfo && data.cameraInfo.length > 0) ? data.cameraInfo[0].devId : null;
                var ownVideo = document.querySelector('.vdo_r video');

                bindVideo(data.ownerWnd, ownVideo);

                $('#vdo_btn_Count').html(1)
                $('#notConnectCount').html(initData.userUniIdList.length - 1)
                $('#connectCount').html(1)
                $('#topconnectCount').html(1)
                $(ownVideo).parents('.vdo_out').addClass('mySelf').data('wnd', data.ownerWnd).attr('uniid', initData.curUserUniID);
//打开视频和音频
                playMedia(jsondata);
                settinginfos = data;
                //绑定获取的可用设备
                multimediaSeting(data)
                if (data.audioOutputInfo && data.audioOutputInfo.length > 0) {
                    $('.vdo_invite_hint').hide();
                } else {
                    $('.vdo_invite_hint').show();
                }
            })
            ReceiveNotifyResponseVideoMeeting();
        } else if (ngflag == 'to_be_videomeetingcalled') {//被叫
            video_role = 3
            loadJuFeng().then(function (data) {
                videoQunCalled(data)
            })

        }

    }

    //验证视频会议
    function MtcCreateVideoMeeting(parm) {
        var parm = {displayName: meetingTitle, title: '视频会议', password: '123'}
        try {
            window.lxpc.exebusinessaction('VideoConf', 'MtcCreateVideoMeeting', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                if (status == 0) {

                    var data = JSON.parse(jsondata);
                    confId = data.confId;
                    initData.password = data.password;
                    var parm1 = {displayName: meetingTitle, juFengId: confId, password: data.password}

                    try {
                        window.lxpc.exebusinessaction('VideoConf', 'MtcJoinVideoMeeting', '0', JSON.stringify(parm1), 0, function (status, jsondata, targ) {
                            if (status == 0) {
                                initData.sessionId = JSON.parse(jsondata).sessionId
                                var userlist = []
                                for (var i = 0; i < initData.userUniIdList.length; i++) {
                                    var cur = initData.userUniIdList[i]
                                    userlist.push(cur.userUniId)
                                }
                                var parm = {
                                    juFengId: confId,
                                    passwd: data.password,
                                    userUniIdList: userlist,
                                    invitedGroups: initData.invitedGroups,
                                    name: meetingTitle
                                };

                                try {
                                    window.lxpc.exebusinessaction('VideoConf', 'CreateVideoMeeting', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                                        console.log('CreateVideoMeeting===');
                                        if (status == 0) {

                                            var result = JSON.parse(jsondata);
                                            var qun = result.qun
                                            initData.meetingQunId = qun.dialogId;
                                            qunId = qun.id;
                                            initData.userUniIdList = datalist = result.qun.members;
                                            notJointCount = initData.userUniIdList.length - 1;
                                            JoinCount = 1;
                                            var str = bindmemberInfo(result.qun.members);
                                            var vdo_notConnect = document.getElementById('vdo_notConnect')
                                            vdo_notConnect.innerHTML = str;
                                            myscroll3.refresh();
                                            var connectCount = document.getElementById('connectCount')
                                            connectCount.innerHTML = 1;
                                            var notconnectCount = document.getElementById('notConnectCount')
                                            notconnectCount.innerHTML = datalist.length - 1;
                                            $('#vdo_btn_AllCount').html(initData.userUniIdList.length);
                                            var index = datalist.findIndex(function (item, index) {
                                                return item.userUniId == initData.curUserUniID
                                            })
                                            videoCount++;
                                            videoRoleList.push(initData.curUserUniID)
                                            audioCount++;
                                            audioRoleList.push(initData.curUserUniID)
                                            if (index > -1) {
                                                initData.hostInfo = datalist[index];
                                                initData.myInfo = datalist[index];
                                                connectList[datalist[index].userUniId] = datalist[index]
                                                $('.vdo_r .main_name').html(initData.hostInfo.name)
                                                $('.vdo_r .main_branch').html(initData.hostInfo.branchPath)
                                            }
                                            // 设置可选人数
                                            canInverterCount = maxInvertCount - initData.userUniIdList.length;
                                            if (initData.userUniIdList.length == maxInvertCount) {
                                                $('#canInvert_count').html('人员已满，不能邀请')
                                            } else {
                                                $('#canInvert_count').html('可邀请' + canInverterCount + '人')
                                            }


                                        }
                                    })
                                } catch (e) {
                                    console.log(e.message)
                                }
                            }
                        })
                    } catch (e) {
                        console.log(e.message)
                    }
                } else {
                }
            })
        } catch (e) {
            console.log(e.message)
        }
    }

    //接受群的视频会议
    function videoQunCalled(jsondata) {

        var parm = {
            dialogId: initData.dialogId,
            opCode: '0',
            juFengId: initData.juFengId,
            userUniId: initData.toUserUniId
        }

        initData.displayName = meetingTitle;
        var parm1 = initData

        try {
            window.lxpc.exebusinessaction('VideoConf', 'MtcJoinVideoMeeting', '0', JSON.stringify(parm1), 0, function (status, jsondata, targ) {
                if (status == 0) {

                    var sessionId=initData.sessionId = JSON.parse(jsondata).sessionId;
                    ResponseVideoMeeting(parm);
                    var obj={isLeaved:0,isStart:1,mediaOption:0,sessionId:sessionId,userUniID:initData.toUserUniId};

                    getJoinMemberVideoInfo(obj);
                }
            })
        } catch (e) {
            console.log(e.message)
        }

        var data = JSON.parse(jsondata);
        initData.ownerWnd = data.ownerWnd;
        initData.peerWnd = data.peerWnd;
        initData.videoId = (data.cameraInfo && data.cameraInfo.length > 0) ? data.cameraInfo[0].devId : null;
        // var ownVideo = document.querySelector('.vdo_l_video');
        // bindVideo(data.ownerWnd, ownVideo);
        // $('#vdo_btn_Count').html(1)
        // $('#notConnectCount').html(initData.userUniIdList.length-1)
        // $('#connectCount').html(1);
        // $('#topconnectCount').html(1)
        // $(ownVideo).parents('.vdo_out').addClass('mySelf').data('wnd', data.ownerWnd).attr('uniid',initData.toUserUniId);
//打开视频和音频
        playMedia(jsondata)
        var data = JSON.parse(jsondata)
        settinginfos = data
        //绑定获取的可用设备
        multimediaSeting(data)
        if (data.audioOutputInfo && data.audioOutputInfo.length > 0) {
            $('.vdo_invite_hint').hide();
        } else {
            $('.vdo_invite_hint').show();
        }

    }

    //ResponseVideoMeeting响应被叫群视频会议
    function ResponseVideoMeeting(parm) {
        try {
            window.lxpc.exebusinessaction('VideoConf', 'ResponseVideoMeeting', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                if (status == 0) {
                }
                else {
                    console.log(status)
                }
            })
        } catch (e) {
            console.log(e.message)
        }
    }

    //绑定视频信息
    function bindVideo(Handel, oVideo, mainVideo) {
        console.log('eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee');
        console.log(Handel);
        console.log(oVideo);
        navigator.getUserMedia({
            audio: false,
            video: {
                mandatory: {
                    chromeMediaSource: 'desktop',
                    chromeMediaSourceId: 'window:' + Handel + ':0',
                    maxWidth: 1920,
                    maxHeight: 1080,
                    maxFrameRate:60

                },
                optional: [
                    {minFrameRate:60},
                    {minWidth: 1920},
                    {minHeight: 1080}
                ],

            }
        }, function (stream) {

            oVideo.onload = function (e) {
                window.URL.revokeObjectURL(this.src); // 清除释放
                $(this).siblings('.vdo_r_callOutD').hide();
                oVideo.attr('wnd', Handel)
            }
            oVideo.src = window.URL.createObjectURL(stream);
            $(oVideo).siblings('.vdo_r_callOutD').hide();

        }, function () {
            console.log('Error, Screen stream is not available.')
        })
    }

    //接收视频信息
    var hasJoinList = {};
    var ltarg = 0, JoinCount = 0, notJointCount = 0;

    function ReceiveVideoCallResult() {

        try {
            window.lxpc.exebusinessaction('VideoConf', 'ReceiveVideoCallResult', '0', JSON.stringify({}), 0, function (status, jsondata, targ) {
                console.log('ReceiveVideoCallResult--------------------')
                console.log(jsondata)
                debugger;
                if (status == 0) {
                    var nflg = initData.flag
                    var data = JSON.parse(jsondata);

                    if (nflg == 'qun_videomeetingcaller' || nflg == 'to_be_videomeetingcalled') {//视频会议
                        if (data.isLeaved == 0) {//加入会议

                            if (nflg == 'qun_videomeetingcaller') {
                                if (data.userUniID == initData.curUserUniID) {// 主持人自己

                                } else {
                                    if (ltarg == 0) {
                                        $('.vdo_l_wait_member').hide();
                                        var oTime = document.getElementById('vdo_time');
                                        timer_video = setTimer(oTime);
                                        replayAudioTip(3);
                                        $('.vdo_l_wait_member').hide();
                                        ltarg++;
                                    }


                                    getJoinMemberVideoInfo(data, $li);

                                }
                            } else {
                                if (JoinCount == 1) {
                                    $('.vdo_l_wait_member').hide();
                                }
                                getJoinMemberVideoInfo(data);
                            }
                        } else {//退出会议
                            if (data.userUniID === initData.hostInfo.userUniId) {//主持人
                                TerminateVideoConf();
                                return;
                            }
                            JoinCount--;
                            connectList[data.userUniID] = null;
                            notJointCount = initData.userUniIdList.length - JoinCount;
                            videoCount--;
                            var videoRoleId = videoRoleList.indexOf(data.userUniID);
                            if (videoRoleId > -1) videoRoleList.splice(videoRoleId, 1);
                            audioCount--;
                            var audioRoleId = audioRoleList.indexOf(data.userUniID);
                            if (audioRoleId > -1) audioRoleList.splice(audioRoleId, 1)
                            var tem = hasJoinList[data.userUniID];
                            hasJoinList[data.userUniID] = null;
                            $('#vdo_btn_Count').html(JoinCount);
                            $('#connectCount').html(JoinCount);
                            $('#topconnectCount').html(JoinCount);
                            $('#notConnectCount').html(notJointCount);

                            if ((tem.mediaOption == 3 || tem.mediaOption == 2) && tem.isStart == 0) {

                            } else {

                                if (mainVideo === data.userUniID) {//主窗口显示的人员离开视频会议
                                    setMainVideo();

                                } else {
                                    var peerVideo = $('.vdo_out[uniid="' + data.userUniID + '"] ').parents('.vdo_lD');
                                    peerVideo.remove();
                                }
                            }

                            var $li = $('#vdo_connecting li[uniid="' + data.userUniID + '"]');
                            $li.find('.vdo_noReceive_tip').html('挂断');
                            if (video_role == 2) {

                                $('#vdo_notConnect').append($li);
                                myscroll3.refresh();
                                $li.removeClass('recalling');
                            } else {
                                $li.remove();
                            }


                        }

                    } else {//视频通话
                        isconnect = true;
                        replayAudioTip(3)
                        initData.peerWnd = data.peerWnd
                        initData.sessionId = data.sessionId//添加新的字段 sesstionId用于关闭和打开视频
                        var peerVideo = document.querySelector('.vdo_r_callOut')
                        bindVideo(data.peerWnd, peerVideo, true);
                        $('.vdo_r .vdo_out').addClass('wnd_' + data.peerWnd);
                        var oTime = document.getElementById('vdo_time')
                        timer_video = setTimer(oTime)
                    }

                } else {
                    console.log(status)
                }
            })
        } catch (e) {
            console.log(e.message)
        }
    }

    //视频会议被叫被推送的数据
    function getJoinMemberVideoInfo(data, $li) {

        var item = hasJoinList[data.userUniID];
        var tips = '';

        var userInfo = $('.vdo_rL_tabC li[uniid="' + data.userUniID + '"] ');
        var $Mick = userInfo.find('.vdo_rL_iMute');
        var $video = userInfo.find('.vdo_rL_iVideo');

        if (item) {
            var item = hasJoinList[data.userUniID]
            if (item.mediaOption === data.mediaOption && item.isStart === data.isStart) {
                return;
            }
            hasJoinList[data.userUniID] = data;
            var $vdo_out = $('.vdo_out[uniid="' + data.userUniID + '"] ')
            var peerVideo = $vdo_out.parents('.vdo_lD');
            if (peerVideo.length == 0) {
                peerVideo = $vdo_out
            }

            var isMyinfo = data.userUniID == initData.myInfo.userUniId;

            if (data.mediaOption === 0) {//都没有打开
                if (peerVideo.length > 0) {
                    peerVideo.remove()
                }
                if (mainVideo === data.userUniID) setMainVideo();
            } else if (data.mediaOption === 1) { // 主持人禁掉或开启某人语音
                if (data.isStart == 1) {//打开
                    if (video_role == 3) {
                        tips = '音频已被开启'
                        if (isMyinfo) {
                            showtips('主持人取消了您的静音，您可以讲话了',null,{top:'-40%'})
                        }
                    } else {
                        tips = '点击禁言'

                    }
                    $Mick.attr('title', tips)
                    peerVideo.find('.vdo_l_mute').hide();
                } else {
                    if (video_role == 3) {
                        tips = '主持人未开启音频'
                        if (isMyinfo) {
                            showtips('您已被主持人静音',null,{top:'-40%'})
                        }
                    } else {
                        tips = '恢复通话'
                    }
                    $Mick.attr('title', tips)
                    peerVideo.find('.vdo_l_mute').show();


                }

            } else if (data.mediaOption === 2) {//主持人禁掉或开启某人视频
                if (data.isStart == 1) {//打开
                    if (video_role == 3) {
                        tips = '视频已被开启'
                        if (isMyinfo) {
                            showtips('主持人开启了您的视频，别人能看到你了')
                        }
                    } else {
                        tips = '关闭视频'
                    }
                    $video.attr('title', tips)
                    // peerVideo.find('.vdo_l_bac').hide();
                    if (data.peerWnd) {
                        if(peerVideo.length == 0){
                            var index = initData.userUniIdList.findIndex(function (item) {
                                return item.userUniId == data.userUniID
                            })
                            if (index > -1) {

                                var peerVideo = bindleftVideo(initData.userUniIdList[index], data);
                                var $out = peerVideo.parents('.vdo_out')
                                if (item.mediaOption == 1) {
                                    if (item.isStart == 1) {
                                        $out.find('.vdo_l_mute').hide();
                                    } else {
                                        $out.find('.vdo_l_mute').show();
                                    }
                                }

                                bindVideo(data.peerWnd, peerVideo[0]);
                            }

                        }
                    }


                } else {
                    peerVideo.remove();

                    if (video_role == 3) {
                        tips = '主持人未开启视频'
                        if (isMyinfo) {
                            showtips('主持人关闭了您的视频')
                        }
                    } else {
                        tips = '打开视频'
                    }
                    $video.attr('title', tips)
                    if (mainVideo === data.userUniID) setMainVideo();

                }
            } else if (data.mediaOption === 3) {//主持人禁掉或开启某人视频和语音
                if (data.isStart == 1) {//打开
                    var tipAuto = ''
                    if (video_role == 3) {
                        tips = '视频已被开启'
                        tipAuto = '音频已被开启'
                        if (isMyinfo) {
                            showtips('主持人开启了您的视频，别人能看到你了')
                        }
                    } else {
                        tips = '关闭视频'
                        tipAuto = '点击禁言'
                    }
                    $video.attr('title', tips);
                    $Mick.attr('title', tipAuto);
                    if (data.peerWnd) {
                        if (peerVideo.length == 0) {
                            var index = initData.userUniIdList.findIndex(function (item) {
                                return item.userUniId == data.userUniID
                            })
                            if (index > -1) {

                                var peerVideo = bindleftVideo(initData.userUniIdList[index], data);
                                bindVideo(data.peerWnd, peerVideo[0]);
                            }
                        }
                    }

                } else {
                    if (video_role == 3) {
                        tips = '主持人未开启视频'
                        tipAuto = '主持人未开启音频'
                        if (isMyinfo) {
                            showtips('主持人关闭了您的视频')
                        }
                    } else {
                        tips = '打开视频'
                        tipAuto = '恢复通话'
                    }
                    $video.attr('title', tips);
                    $Mick.attr('title', tipAuto)
                    peerVideo.remove();
                    if (mainVideo === data.userUniID) setMainVideo();

                }
            }
            setVideoOrAudioAuthority(data)
            return;
        } else {
            hasJoinList[data.userUniID] = data;
            JoinCount++;
            notJointCount = initData.userUniIdList.length - JoinCount;
            $('#vdo_btn_Count').html(JoinCount);
            $('#connectCount').html(JoinCount)
            $('#topconnectCount').html(JoinCount)
            $('#notConnectCount').html(notJointCount)
            var curMember = data;
            var index = initData.userUniIdList.findIndex(function (item) {
                return item.userUniId == data.userUniID
            })
            if (index > -1) {
                curMember = initData.userUniIdList[index];
                connectList[data.userUniID] = curMember
                if (data.userUniID === initData.hostInfo.userUniId) {//主持人

                    if ((data.mediaOption == 2 || data.mediaOption == 3)) {
                        if (data.isStart == 1) {
                            var peerVideo = $('.vdo_r video');
                            bindVideo(data.peerWnd, peerVideo[0]);
                            $('.vdo_r .vdo_out').attr('uniid', data.userUniID);
                            mainVideo = data.userUniID;

                        }
                    }
                    bindmemberInfoforCalled(curMember, data, true);

                    $('.vdo_r .main_name').html(curMember.name)
                    $('.vdo_r .main_branch').html(curMember.branchPath);

                } else {
                    if ((data.mediaOption == 2 || data.mediaOption == 3)) {
                        if (data.isStart == 1) {
                            bindmemberInfoforCalled(curMember, data);
                        }

                    } else if (data.mediaOption == 1) {
                        if (data.isStart == 1) {
                            bindmemberInfoforCalled(curMember, data, true);
                        }
                    } else {
                        bindmemberInfoforCalled(curMember, data, true);
                    }
                }
                if (ltarg == 0) {
                    var oTime = document.getElementById('vdo_time')
                    timer_video = setTimer(oTime);
                    ltarg++;
                }
            } else {
                var parm = {userUniId: data.userUniID, dialogType: 2, orgDomain: initData.orgDomain};
                senderId += 1
                QuerySenderInfo(parm, senderId).then(function (result) {
                    var info = result.info,
                        targ = result.index;
                    if (Object.prototype.toString.call(info) == '[object Array]') {
                        if (info.length > 0) {
                            info[0].userUniId = data.userUniID;
                            initData.userUniIdList.push(info[0]);
                            connectList[data.userUniID] = info[0]
                            if ((data.mediaOption == 2 || data.mediaOption == 3)) {
                                if (data.isStart == 1) {

                                    bindmemberInfoforCalled(info[0], data);
                                }

                            } else if (data.mediaOption == 1) {
                                if (data.isStart == 1) {

                                    bindmemberInfoforCalled(curMember[0], data, true);
                                }
                            } else {

                                bindmemberInfoforCalled(curMember[0], data, true);
                            }

                            $('#vdo_btn_AllCount').html(initData.userUniIdList.length);
                        }
                    }
                })
            }

            setVideoOrAudioAuthority(data)
        }
    }
//主持人对与会成员食品和语音权限设置
    function setVideoOrAudioAuthority(data){
        var userInfo = $('.vdo_rL_tabC li[uniid="' + data.userUniID + '"] ');
        var $Mick = userInfo.find('.vdo_rL_iMute');
        var $video = userInfo.find('.vdo_rL_iVideo');

            var audioRoleId = audioRoleList.indexOf(data.userUniID);
            var videoRoleId = videoRoleList.indexOf(data.userUniID);
            // var noVideoList=$('#vdo_connecting .vdo_rL_iVideo.on')
            // var noAudioList=$('#vdo_connecting .vdo_rL_iMute.on')
                if(!hasJoinList[data.userUniID]){
                    var $li = $('#vdo_notConnect li[uniid="' + data.userUniID + '"]');
                    $('#vdo_connecting').append($li);
                    myscroll3.refresh()
                }

            if(data.mediaOption==3){
                if (data.isStart == 1) {
                    $Mick.removeClass('on');
                    $video.removeClass('on');
                    videoCount++;
                    audioCount++;

                    if ((mainVideo == data.userUniID) || mainVideo == '') {

                        $('#vdo_connecting').prepend(userInfo)
                    } else {
                        if (videoRoleList.length > 0) {
                            var $Videoli = $('#vdo_connecting li:eq(' + (videoRoleList.length - 1) + ')');
                            $Videoli.after(userInfo)
                        } else {
                            $('#vdo_connecting').prepend(userInfo)
                        }
                    }

                    if (audioRoleId == -1) audioRoleList.push(data.userUniID);
                    if (videoRoleId == -1) videoRoleList.push(data.userUniID);

                    if(videoRoleList.length==5){
                        $('#vdo_connecting .vdo_rL_iVideo.on').addClass('no');
                    }
                    if(audioRoleList.length==16){
                        $('#vdo_connecting .vdo_rL_iMute.on').addClass('no');
                    }

                }else{
                    $Mick.addClass('on');
                    $video.addClass('on');

                    if(videoRoleList.length!=0||audioRoleList.length!=0){
                        $('#vdo_connecting').append(userInfo)
                    }

                    videoCount--;
                    audioCount--;
                    if (audioRoleId > -1) {
                        if(audioRoleList.length==16){
                            $('#vdo_connecting .vdo_rL_iMute.on').removeClass('no');
                        }
                        audioRoleList.splice(audioRoleId,1);
                    }else{
                        if(audioRoleList.length==16){
                            $Mick.addClass('no')
                        }

                    }

                    if (videoRoleId > -1){
                        if(videoRoleList.length==5){
                            $('#vdo_connecting .vdo_rL_iVideo.on').removeClass('no');
                        }
                        videoRoleList.splice(videoRoleId,1);
                    } else{
                        if(videoRoleList.length==5){
                            $video.addClass('no');
                        }

                    }


                }
            }
            else if ((data.mediaOption == 2)) {
                if (data.isStart == 1) {
                    $video.removeClass('on');


                        if(mainVideo==data.userUniID||mainVideo==''){

                            $('#vdo_connecting').prepend(userInfo)
                        }else{
                            if(videoRoleList.length>0){
                                var $Videoli=$('#vdo_connecting li:eq('+(videoRoleList.length-1)+')');
                                $Videoli.after(userInfo)
                            } else{
                                $('#vdo_connecting').prepend(userInfo)
                            }
                    }
                     videoCount++;
                    if (videoRoleId == -1) videoRoleList.push(data.userUniID)
                    if(videoRoleList.length==5){
                        $('#vdo_connecting .vdo_rL_iVideo.on').addClass('no');
                    }

                } else {
                    $video.addClass('on');

                    if(audioRoleList.length!=0||videoRoleList.length!=0){
                        if(audioRoleId>-1){
                            var $Audioli=$('#vdo_connecting li:eq('+(audioRoleList.length-1)+')');
                            $Audioli.after(userInfo)
                        }else{
                            $('#vdo_connecting').append(userInfo)
                        }
                    }

                    videoCount--;
                    if (videoRoleId > -1) {
                        if(videoRoleList.length==5){
                            $('#vdo_connecting .vdo_rL_iVideo.on').removeClass('no');
                        }
                        videoRoleList.splice(videoRoleId,1)
                    } else{
                        if(videoRoleList.length==5){
                            $video.addClass('no')
                        }
                    }

                }


            } else if (data.mediaOption == 1) {

                if (data.isStart == 1) {
                    $Mick.removeClass('on');
                    if(videoRoleId>-1){
                        // return;
                        // var $Videoli=$('#vdo_connecting li:eq('+(videoRoleList.length-1)+')');
                        // $Videoli.after(userInfo)
                    }else{
                        if(videoRoleList.length>0){
                            var $Videoli=$('#vdo_connecting li:eq('+(videoRoleList.length-1)+')');
                            $Videoli.after(userInfo)
                        }else if(audioRoleList.length>0){
                            var $Audioli=$('#vdo_connecting li:eq('+(audioRoleList.length-1)+')');
                            $Audioli.after(userInfo)
                        } else{

                            $('#vdo_connecting').prepend(userInfo)
                        }
                    }

                    audioCount++;
                    var audioRoleId = audioRoleList.indexOf(data.userUniID);
                    if (audioRoleId == -1){
                        audioRoleList.push(data.userUniID);
                    }
                    if(audioRoleList.length==16){
                        $('#vdo_connecting .vdo_rL_iMute.on').addClass('no');
                    }

                } else {
                    $Mick.addClass('on');
                    if(audioRoleList.length!=0||videoRoleList.length!=0){
                      if(videoRoleId>-1){
                          // var $Videoli=$('#vdo_connecting li:eq('+(videoRoleList.length-1)+')');
                          // $Videoli.after(userInfo)
                      }else{
                          $('#vdo_connecting').append(userInfo)
                      }
                    }
                    audioCount--;
                    var audioRoleId = audioRoleList.indexOf(data.userUniID);
                    if (audioRoleId > -1) {
                        if(audioRoleList.length==16){
                            $('#vdo_connecting .vdo_rL_iMute.on').removeClass('no');
                        }
                        audioRoleList.splice(audioRoleId,1);

                    } else{
                        if(audioRoleList.length==16){
                            $Mick.addClass('no');
                        }
                    }
                }
            } else if(data.mediaOption==0){
                $Mick.addClass('on');
                $video.addClass('on');
                if(videoRoleList.length>0){
                    var $Videoli=$('#vdo_connecting li:eq('+(videoRoleList.length-1)+')');
                    $Videoli.after(userInfo)
                }else if(audioRoleList.length>0){
                    var $Audioli=$('#vdo_connecting li:eq('+(audioRoleList.length-1)+')');
                    $Audioli.after(userInfo)
                } else{
                    $('#vdo_connecting').append(userInfo)
                }
                videoCount--;
                audioCount--;
                if(audioRoleId > -1){
                    if(audioRoleList.length==16){
                        $('#vdo_connecting .vdo_rL_iMute.on').removeClass('no');
                    }
                    audioRoleList.splice(audioRoleId,1);
                }else{
                    if(audioRoleList.length==16){
                        $video.addClass('no');
                    }
                }
                if(videoRoleId>-1){

                    if(videoRoleList.length==5){
                        $('#vdo_connecting .vdo_rL_iVideo.on').removeClass('no');
                    }
                    videoRoleList.splice(videoRoleId,1)
                }else{
                    if(videoRoleList.length==5){
                        $video.addClass('no');
                    }
                }

            }

    }

    function setMainVideo() {
        debugger;
        var peerVideo = $('.vdo_r .vdo_out')
        peerVideo.remove();
        var $outL = $('.vdo_l .vdo_out:eq(1)');
        if ($outL.length > 0) {
            var newMainVideo = $outL.attr('uniid')
        }
        var $ParetL = $outL.parents('.vdo_lD')
        $('.vdo_r').prepend($outL);
        $ParetL.remove();
        // var outLFirst = $('.vdo_l .vdo_out:eq(1)');
        // if (videoRoleList.length > 0) {
            if (mainVideo != '') {
                $oldLi = $('#vdo_connecting li[uniid="' + mainVideo + '"]');

                if (audioRoleList.indexOf(mainVideo) > -1) {

                    var $audio = $('#vdo_connecting li:eq(' + (audioRoleList.length-1) + ')');


                    if($audio.length>0){
                        $audio.after($oldLi)
                    }else {
                       $('#vdo_connecting').append($oldLi)
                    }
                } else {

                        $('#vdo_connecting').append($oldLi)

                }
                mainVideo= newMainVideo||''
            }else{
                mainVideo = newMainVideo||'';
            }


    }

    //绑定设备信息
    function multimediaSeting(data) {
        var camerli = $('.set1');
        var audioInputli = $('.set2');
        var audioOutputli = $('.set3');
//        bindPlayer(data.cameraInfo, camerli, '没有摄像头设备')
//        bindPlayer(data.audioInputInfo, audioInputli, '没有麦克风设备')
//        bindPlayer(data.audioOutputInfo, audioOutputli, '没有扬声器设备')
        if (data.audioInputInfo.length > 0) {
            initData.audioInputId = data.audioInputInfo[0].devId;
            var parm = {action: "volume", audioInputId: initData.audioInputId, volumePercent: 80}
            initData.setInitAutio = true;
            ControlAudio(parm).then(function (data) {

            })
        } else {
            initData.audioInputId = null;
        }
        if (data.cameraInfo.length == 0) {
            $('.vdo_btn_camera ').addClass('no')
        } else {
            $('.vdo_btn_camera ').removeClass('no')
        }
        if (data.audioOutputInfo.length == 0) {
            $('.vdo_btn_mic  ').addClass('no')
        } else {
            $('.vdo_btn_mic  ').removeClass('no')
        }
        if (data.cameraInfo.length == 0 || data.audioInputInfo.length == 0 || data.audioOutputInfo.length == 0) {
            $('.vdo_btn_l').show()
        } else {
            $('.vdo_btn_l').hide()
        }
//        function bindPlayer(data, $box, strTip) {
//            var str = ''
//            var ul = $box.find('.vdo_drop_list')
//            if (data && data.length > 0) {
//                ul.empty()
//                str += `<li title="Windows默认设备">Windows默认设备</li>`
//                for (var i = 0; i < data.length; i++) {
//                    var curli = data[i];
//                    str += `<li title="${curli.devName}" >${curli.devName}</li>`
//                }
//                str += `<li title="禁用" class="disabled">禁用</li>`
//                ul.append(str);
//            } else {
//                ul.empty()
//                $box.find('span').html(strTip)
//                $box.find('.vdo_drop_ModifyThe').addClass('vdo_drop_MNo')
//            }
//        }
//
//        $('.vdo_drop_list  li').click(function (e) {
//            var $ele = $(this);
//            var s_txt = $ele.text();
//            var $parent = $ele.parent(".vdo_drop_list")
//            $parent.hide();
//            var parentPre = $parent.prev('.vdo_drop_ModifyThe')
//            parentPre.removeClass("vdo_drop_aB")
//            parentPre.find('span').html(s_txt)
//            e.stopPropagation()
//            var vdo_drop = $ele.parents('.vdo_drop')
//            if (vdo_drop.hasClass('set1')) {//麦克风
//                if ($ele.hasClass('disabled')) {
//                    $('.vdo_btn_mic').removeClass('on').addClass('no')
//                    $('.vdo_btn_l').show()
//                } else {
//                    $('.vdo_btn_mic').removeClass('no')
//                }
//            } else if (vdo_drop.hasClass('set2')) {//摄像头
//                if ($ele.hasClass('disabled')) {
//                    $('.vdo_btn_camera ').removeClass('on').addClass('no')
//                    $('.vdo_btn_l').show()
//                } else {
//                    $('.vdo_btn_camera ').removeClass('no')
//                }
//            } else if (vdo_drop.hasClass('set3')) {//静音
//                if ($ele.hasClass('disabled')) {
//                    $('.vdo_btn_mute ').removeClass('on').addClass('no')
//                    $('.vdo_btn_l').show()
//                } else {
//                    $('.vdo_btn_mute ').removeClass('no')
//                }
//            }
//        })
    }

    // 点击切换左侧视频列表和主视频区域
    function changeVideo(ele, e) {

        var $ele = $(ele)
        var vdo_outL = $ele.find('.vdo_out');
        var vdo_outR = $('.vdo_r .vdo_out');
        var userUniId_L = vdo_outL.attr('uniid');
        var $vdo_L = vdo_outL.clone();
        $('.vdo_r ').prepend($vdo_L);

        if (vdo_outR.length == 0) {

            var $vdo_lD = vdo_outL.parents('.vdo_lD');
            $vdo_lD.remove();
            mainVideo = ''
        } else {
            var $main = vdo_outR.clone(true);
            $ele.append($main)
            vdo_outR.remove()
        }

        vdo_outL.remove();
        if (mainVideo != '' && mainVideo !== userUniId_L) {

            var $li = $('#vdo_connecting li[uniid="' + userUniId_L + '"]');
            var $li_main = $('#vdo_connecting li:first');
            var tem = $li.clone(true);
            $li.replaceWith($li_main);
            $li.remove();
            mainVideo = userUniId_L;
            $('#vdo_connecting').prepend(tem);
        } else {

            mainVideo = userUniId_L;
        }
        mystopPropagation(e)

    }

    //打开登菊峰并打开本机的视频和音频设备
    function openMedia(jsondata) {
        var data = JSON.parse(jsondata);
        initData.ownerWnd = data.ownerWnd;
        initData.peerWnd = data.peerWnd;
        $('.vdo_r .vdo_out').addClass('wnd_' + data.peerWnd);
        $('.vdo_l_video').addClass('wnd_' + data.ownerWnd);
        initData.videoId = (data.cameraInfo && data.cameraInfo.length > 0) ? data.cameraInfo[0].devId : null;
        var ownVideo = document.querySelector('.vdo_l_video');
        bindVideo(data.ownerWnd, ownVideo);
        var vdo_me = $(ownVideo).parents('.vdo_out').addClass('mySelf').data('wnd', data.ownerWnd);
//打开视频和音频
        playMedia(jsondata)
        var data = JSON.parse(jsondata)
        settinginfos = data
        //绑定获取的可用设备
        multimediaSeting(data)
        if (data.audioOutputInfo && data.audioOutputInfo.length > 0) {
            $('.vdo_invite_hint').hide();
        } else {
            $('.vdo_invite_hint').show();
        }
    }

    //    1.	打开或关闭视频
    function ControlVideo(parm) {
        return new Promise(function (resolve, reject) {
            try {
                window.lxpc.exebusinessaction('VideoConf', 'ControlVideo', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                    if (status == 0) {
                        resolve(status)
                    } else {
                        reject(status)
                    }

                })
            } catch (e) {
                reject(e.message)
                console.log(e.message)
            }
        })
    }

    //    1.	2.	打开或关闭音频，调整音量
    function ControlAudio(parm) {
        return new Promise(function (resolve, reject) {
//        var parm={action:stop/start/volume”, ”audioInputId”:"",volumePercent:0-100}
            try {
                window.lxpc.exebusinessaction('VideoConf', 'ControlAudio', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                    if (status == 0) {
                        resolve(status)
                    } else {
                        reject(null)
                    }
                })
            } catch (e) {
                reject(null)
                console.log(e.message)
            }
        })
    }

    //查询人员信息详情
    function QuerySenderInfo(parm, targ) {
        return new Promise(function (resolve, reject) {
            try {
                window.lxpc.exebusinessaction('ChatRecord', 'QuerySenderInfo', '1', JSON.stringify(parm), targ, function (status, result, targ) {
                    if (status == 0) {
                        var result = {info: JSON.parse(result), index: targ}
                        resolve(result)
                    } else {
                        reject(status)
                    }
                })
            } catch (e) {
                reject(e.message)
                console.log(e.message)
            }
        })
    }

    //退出
    function TerminateVideoConf(cb) {
        if (!initData.sessionId) {
            initData.sessionId = 0
        }
        var parm = {sessionId: initData.sessionId}

        try {
            window.lxpc.exebusinessaction('VideoConf', 'TerminateVideoConf', '0', JSON.stringify(parm), 0, function (status, result, targ) {
                console.log('TerminateVideoConf============================', status)
                if (status == 0) {

                    if (Object.prototype.toString.call(cb) === '[object Function]') {
                        cb()
                    } else {
                        window.lxpc.closewnd();
                    }

                } else {
                    my_layer({message: '错误码' + status}, 'error')
                }
            })
        } catch (e) {
            my_layer({message: '错误码' + e.message}, 'error')
            console.log(e.message)
        }
        clearInterval(timer_video)

    }

    //主叫取消视频通话
    function CancelVideoCall(parm) {
        try {
//        var parm={userUniId:"",callType:''}被叫的userUniId  callType:通话类型 1-视频通话，2-语音通话
            window.lxpc.exebusinessaction('VideoConf', 'CancelVideoCall', '0', JSON.stringify(parm), 0, function (status, result, targ) {
                if (status == 0) {


                } else {
                    console.log(status)
                }
            })
        } catch (e) {
            my_layer({message: '错误码' + e.message}, 'error')
            console.log(e.message)
        }
    }

    function VideoMeetingOver(parm) {
        try {
            window.lxpc.exebusinessaction('VideoConf', 'VideoMeetingOver', '0', JSON.stringify(parm), 0, function (status, result, targ) {
                if (status == 0) {
                    // if (video_role === 3) { // 被叫
                    //     TerminateVideoConf();
                    // }
                } else {
                    console.log(status)
                }
            })
        } catch (e) {
            my_layer({message: '错误码' + e.message}, 'error')
            console.log(e.message)
        }
    }

    function MtcCallIncomingNotification() {
    }

    //初始化设置
    function initSetting(type) {
        initData.memberList = [];
        $('vdo_lD').data('index', 0)
        var parm = {userUniId: initData.dialogId, dialogType: 2, orgDomain: initData.orgDomain};
        senderId += 1
        QuerySenderInfo(parm, senderId).then(function (result) {
            var data = result.info,
                targ = result.index;
            if (Object.prototype.toString.call(data) == '[object Array]') {
                if (data.length > 0) {
                    initData.memberList = initData.memberList.concat(data)
                    var item = data[0];
                    var name = item.name,
                        branch = item.branchPath;
                    $('.main_branch').html(branch)
                    $('.main_name').html(name);
                }
            }
        })
        $('.vdo_l_wait_member').hide()
        $('#vdo_tem').show()
        $('.vdo_btn_member').hide()
//        if (initData.isXP) {//Xp系统的设置按钮隐藏
//            $('.vdo_btn_set').hide()
//        } else {
//            $('.vdo_btn_set').show()
//        }

    }

    //初始化设置
    function initSettingforMetting(type) {
        $('.vdo_r .vdo_r_callOutD').hide();
        $('#vdo_tem').hide();
        $('.vdo_l_wait_member').show()
        if (type === "qun_videomeetingcaller") {//视频会议的主持人
            video_role = 2;
            // ModifyWindowTitle({title:meetingTitle})
            $('.PA88').show();
            $('.notConnectCount').show();
            $('#vdo_connecting ').addClass('vdo_qun_call').removeClass('vdo_qun_called');
            document.title = meetingTitle;
            mainVideo = initData.curUserUniID
            // $('#vdo_btn_AllCount').html(initData.userUniIdList.length)
            ReceiveSelectPeople(initData.id, function (data) {
                var orgList = [], memberlist = [];
                var datalist = data.userlist
                for (var i = 0; i < datalist.length; i++) {
                    var curItem = datalist[i];
                    if (curItem.isstruct) {
                        orgList.push({groupId: parseFloat(curItem.userUniId), type: 2, orgType: 0})
                    } else {
                        memberlist.push(curItem.userUniId);
                    }
                }

                var parm = {
                    qunId: qunId,
                    userUniIdList: memberlist,
                    recordDomain: initData.recordDomain,
                    juFengId: confId,
                    passwd: initData.password,
                    invitedGroups: orgList
                }

                InvateVideoMeetingMember(parm).then(function (data) {

                    if (data && data.qunMembers.length > 0) {
                        var datalst = data.qunMembers
                        var str = bindmemberInfo(datalst);
                        // myScroll.refresh();
                        $('#vdo_notConnect').append(str);
                        myscroll3.refresh();
                        initData.userUniIdList = initData.userUniIdList.concat(datalst);

                        notJointCount += datalst.length;
                        canInverterCount = maxInvertCount - initData.userUniIdList.length
                        $('#vdo_btn_AllCount').html(initData.userUniIdList.length);
                        $('#notConnectCount').html(notJointCount);
                        $('#canInvert_count').html('可邀请' + canInverterCount + '人')

                    }
                })

            });
        } else {
            // ModifyWindowTitle({title:initData.MeetingTitle})
            $('.PA88').hide();
            $('.PA42 ').show();
            $('.notConnectCount').hide();
            $('#vdo_connecting ').removeClass('vdo_qun_call').addClass('vdo_qun_called')
            video_role = 3;
            mainVideo = initData.userUniId
            var parm = {userUniId: initData.dialogId, dialogType: 2, orgDomain: initData.orgDomain};
            senderId += 1
            QuerySenderInfo(parm, senderId).then(function (result) {
                var data = result.info,
                    targ = result.index;
                if (Object.prototype.toString.call(data) == '[object Array]') {
                    if (data.length > 0) {

                        var item = data[0];
                        var name = item.name;
                        document.title = meetingTitle = name;
                    }
                }
            })


        }
        $('.vdo_btn_mic').hide();
        $('.vdo_btn_camera').hide();

        if (initData.isXP) {
            SwitchVideoWindow()
        }

    }

    //登录菊峰
    function loadJuFeng() {
        return new Promise(function (resolve, reject) {
            var parm = {}
            try {
                window.lxpc.exebusinessaction('VideoConf', 'GetJusToken', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {

                    if (status == 0) {
                        var data = JSON.parse(jsondata);
                        data.flag = initData.flag;
                        if (video_role == 2) {//视频会议主叫
                            data.userUniId = initData.curUserUniID
                        } else if (video_role == 3) {//视频会议被叫
                            data.userUniId = initData.userUniId
                        }

                        window.lxpc.exebusinessaction('VideoConf', 'LoginJusTalk', '0', JSON.stringify(data), 0, function (status, jsondata, targ) {

                            if (status == 0) {
                                error.Jufeng = true
                                resolve(jsondata)
                            }
                            else {
                                console.log(status)
                                reject(status)
                            }
                        })
                    }
                    else {
                        console.log(status)

                        reject(status)
                    }
                })
            } catch (e) {

                console.log('登陆菊峰失败================================')
                reject(e.message)
            }

        })
    }

    //接受主页面的操作和数据
    function ReceiveIframeWebCall1(handle) {
        try {
            window.lxpc.exebusinessaction(handle, 'ReceiveIframeWebCall', '0', JSON.stringify({}), 0, function (status, result, targ) {
                if (status == 0) {

                    result = JSON.parse(result);
                    if (result.action == 'close') {

                        layOutMsgBOx()
                    } else if (result.action == 'ReceiveVideoConfStatus') {// 接收由extendFrame 注册ReceiveVideoConfStatus 返回的数据
                        ReceiveVideoConfStatus(result.data)
                    }

                }
            })
        } catch (e) {
        }
    }

    //原生弹窗
    function ConfirmMsgBox(parm) {
        return new Promise(function (resolve, reject) {
            try {
                window.lxpc.exebusinessaction('VideoConf', 'ConfirmMsgBox', '0', JSON.stringify(parm), 0, function (status, result, targ) {
                    if (status == 0) {
                        var data = parseInt(result)
                        resolve(data)

                    } else {
                        reject(status)
                    }
                })
            } catch (e) {
                reject(e.message)
                console.log(e.message)
            }


        })
    }

    function layOutMsgBOx() {
        var msgTip = ''
        if (video_role == 0 || video_role == 1) {
            msgTip = '您确定要退出此次视频通话？'
        } else if (video_role == 2) {
            msgTip = '您是会议主持人，您确定要结束本次会议吗？'
        } else {
            msgTip = '您确定要退出此次视频会议么？'
        }

        if (initData.isXP) {
            var parm = {title: '蓝信', text: msgTip}
            ConfirmMsgBox(parm).then(function (data) {
                if (data == '0') {//同意
                    exitVideoIsManual = true
                    exitVideo()
                }
            })
        } else {
            my_layer({message: msgTip}, 'confirm', function () {
                exitVideoIsManual = true
                exitVideo();
            })
        }
    }

    //d定时器
    function setTimer(oTime) {
        var value = 0
        var sec = 0, min = 0, h = 0, result = '00:00', tem = 0;
        return setInterval(function () {
            value++;
            tem = value;
            if (value < 60) {
                //result= '00:'+(value<10?('0'+value):value);
                result = '00:' + ToDou(value);
            } else if (value < 60 * 60) {
                min = Math.floor(value / 60);
                sec = value % 60;
                result = ToDou(min) + ':' + ToDou(sec)
            } else {
                h = Math.floor(tem / (60 * 60));
                tem %= 60 * 60;
                min = Math.floor(tem / 60);
                tem %= 60;
                sec = tem;

                result = ToDou(h) + ':' + ToDou(min) + ':' + ToDou(sec);

            }
            oTime.innerHTML = result
        }, 1000)

        function ToDou(n) {
            var result = n >= 0 && n < 10 ? ("0" + n) : n;
            return result;
        }
    }

    //生成消息接口
    /**
     *
     * @param parm {sender：发送者userdialogid，messageType：视频会议=2，视频通话=1,dialogId:接收者userdialogid,message:消息内容，base64格式}
     * @constructor
     */
    function GenerateVideoMessage(parm) {
        //var parm={sender:'',messageType:'',dialogId:'',message:''}
        //messageType  视频会议=2，视频通话=1
//        sender       发送者userdialogid
//        dialogId      接收者userdialogid
//        message       消息内容，base64格式

        return new Promise(function (resolve, reject) {
            try {
                window.lxpc.exebusinessaction('VideoConf', 'GenerateVideoMessage', '0', JSON.stringify(parm), 0, function (status, result, targ) {
                    if (status == 0) {
                        var data = parseInt(result)
                        resolve(data)

                    } else {
                        reject(status)
                    }
                })
            } catch (e) {
                reject(e.message)
                console.log(e.message)
            }


        })
    }

    /**
     * 绑定与会人员的信息
     */
    function bindJoinMember() {
        if (initData.flag == 'qun_videomeetingcaller') {//主叫

        } else {//被叫
            var parm = {dialogId: initData.dialogId, orgDomain: initData.orgDomain}
            getQunMemberInfo(parm).then(function (datalist) {

                initData.userUniIdList = datalist;
                $('#vdo_btn_AllCount').html(datalist.length);
                initData.userUniIdList.forEach(function (item) {
                    if (item.userUniId == initData.userUniId) {
                        initData.hostInfo = item;
                    } else if (item.userUniId == initData.toUserUniId) {
                        initData.myInfo = item;
                    }
                })

            })
        }

    }

    function bindmemberInfo(datalist) {

        var str = ''

        for (var i = 0; i < datalist.length; i++) {
            var curMember = datalist[i];
            var name = '';
            name = XssToString(curMember.name);
            var tem = `<li uniid="${curMember.userUniId}">
                             <span class="vdo_rL_lBtn2">`
            if (curMember.userUniId == initData.curUserUniID) {
                name = curMember.name + '(主持人)';
            } else {
                name = curMember.name
                tem += '<i class="vdo_rL_iKick" title="断开" data-type="1"></i>'
            }
            tem += `<i class="vdo_rL_iMute" title="点击禁言" data-type="2"></i>
                 <i class="vdo_rL_iVideo" title="关闭视频" data-type="3"></i>
                 <i class="vdo_rL_iReCalled" title="重拨" data-type="4"></i>
                 <span class="vdo_noReceive_tip">未接听</span></span>
                 <img src="images/card_icon.png" data-resid="${curMember.photoResId}" onload="getImge(this)">
                  <p>${name}</p></li>`
            if (curMember.userUniId == initData.curUserUniID) {//当前的用户的信息再次不现实，在后边会显示
                var vdo_Connect = document.getElementById('vdo_connecting')
                vdo_Connect.innerHTML = tem;
                // hasJoinList[curMember.userUniId] = curMember;
            } else {

                str += tem;
            }
        }
        return str
    }

    function bindleftVideo(curMember, controlInfo) {

        var vdo = $('#vdo_tem'),
            $scroll = $('.vdo_l .scroll');
        var vdo_clone = vdo.clone(true);
        vdo_clone.find('.vdo_lD_b').html(curMember.name);
        vdo_clone.find('video').attr('src', '');
        vdo_clone.find('.vdo_tip').html('正在连接');
        vdo_clone.find('.vdo_l_bac').hide();
        // vdo_clone.data('uniid', curMember.userUniId);
        if (controlInfo) {
            if (controlInfo.mediaOption == 2 && controlInfo.isStart == 1) {
                vdo_clone.find('.vdo_l_mute').show();
            }
        }
        var $out=vdo_clone.find('.vdo_out');
        $out.attr('uniid', curMember.userUniId);
        if(mainVideo==''){
            var newvideo = $out.prependTo('.vdo_r');
            mainVideo=curMember.userUniId;
            var $li=$('#vdo_connecting li[uniid="'+curMember.userUniId+'"]');
            $('#vdo_connecting').prepend($li);
        }else{
            var newvideo = vdo_clone.appendTo($scroll);
        }

        newvideo.show();
        var $video = newvideo.find('video')
        return $video;
    }

    function bindmemberInfoforCalled(data, videoinfo, isNotCreatvideo) {
        var vdo = $('.vdo_l .vdo_lD:eq(0)'),
            $scroll = $('.vdo_l .scroll');
        var str = ''
        var curMember = data;
        var name = curMember.name
        if (videoinfo && videoinfo.userUniID == initData.hostInfo.userUniId) {
            name = name + '(主持人)'
        }
        name = XssToString(name);
        var muteStatus = '', videoStatus = ''
        if (videoinfo.mediaOption == 0) {
            muteStatus = 'no'
            videoStatus = 'no'
        } else if (videoinfo.mediaOption == 1) {
            if (videoinfo.isStart == 0) {
                muteStatus = 'no'
            }

        } else if (videoinfo.mediaOption == 2) {
            if (videoinfo.isStart == 0) {
                videoStatus = 'no'
            }

        } else if (videoinfo.mediaOption == 3) {
            if (videoinfo.isStart == 0) {
                muteStatus = 'no'
                videoStatus = 'no'
            }

        }
        var tem = `<li uniid="${curMember.userUniId}">
                             <span class="vdo_rL_lBtn2">
                             <i class="vdo_rL_iKick" title="断开" data-type="1"></i>
                             <i class="vdo_rL_iMute ${muteStatus}" title="音频已被开启" data-type="2"></i>
                             <i class="vdo_rL_iVideo ${videoStatus}" title="视频已被开启" data-type="3"></i>
                             </span>
                             <img src="images/card_icon.png" data-resid="${curMember.photoResId}" onload="getImge(this)">
                                    <p title="${name}">${name}</p></li>`

        str += tem;

        if (!isNotCreatvideo) {
            if (videoinfo.peerWnd) {
                var vdo_clone = vdo.clone(true);
                vdo_clone.find('.vdo_lD_b').html(curMember.name);
                vdo_clone.find('.vdo_tip').html('正在连接');
                vdo_clone.find('.video').attr('src', '');
                vdo_clone.find('.vdo_l_bac').hide();
                vdo_clone.data('uniid', curMember.userUniId)
                vdo_clone.find('.vdo_out').attr('uniid', curMember.userUniId);
                vdo_clone.show();
                $scroll.append(vdo_clone);
                var newvdo = vdo_clone.appendTo($scroll)
                var peerVideo = newvdo.find('video');
                bindVideo(videoinfo.peerWnd, peerVideo[0])
            }
        }
        if (video_role == 3) {

            if (isNotCreatvideo) {

                if(videoinfo && videoinfo.userUniID == initData.hostInfo.userUniId){
                    $('#vdo_connecting').prepend(str);

                }else{
                    $('#vdo_connecting').append(str);
                }

            } else {

                $('#vdo_connecting').append(str);
            }
        }


        myScroll.refresh();
        myscroll3.refresh();
    }

    function getImge(ele) {

        var $ele = $(ele)
        var resId = $ele.data('resid')
        if (!resId) {
            return;
        }
        var parm = {resourceList: [{photoResId: resId}], size: 96}
        imgList.push($ele);
        var itarg = imgList.length - 1
        try {
            window.lxpc.exebusinessaction('DownloadResource', 'MemberImage', '0', JSON.stringify(parm), itarg, function (status, result, targ) {
                var item = imgList[targ];
                var $img = item
                if (status == 0) {
                    if (result.indexOf('\\') > -1 || result.indexOf('/') > -1) {
                        $img.attr('src', result);
                        $img.load(function (e) {
                            $(this).off();
                            this.onload = null;
                            $img.attr('onload', '')
                        })
                        $img.error(function (e) {
                            $(this).off();
                            this.src = 'images/card_icon.png';
                            this.onload = null;
                            $img.attr('onload', '')
                        })

                    } else {
                        $img.attr('onload', '')
                        $img.off();
                    }
                } else {
                    console.log(status)
                    $img.off();
                }
            })
        }
        catch (e) {
            console.log(e.message)
        }


    }

    //当用户正在忙的时候语音提示
    /**
     * 语音提示
     * @param type==0 忙 type==1 呼叫 type=2 停止播放
     */
    function replayAudioTip(type) {
        if (initData.docPath) {
            var audio = document.getElementById('audio');
            if (type == 1) {
                audio.src = initData.docPath + '\\' + 'ring_call.wav';
            } else if (type == 0) {
                audio.src = initData.docPath + '\\' + 'ring_busy.wav';
            } else {
                audio.pause()
            }
        }
    }

    //退出视频
    function exitVideo() {
        var type = 1
        if (video_role == 0 || video_role == 1) {//视频通话
            type = 1
        } else {//视频会议
            type = 2
        }
        clearInterval(timer_video)
        if (!error.Jufeng) {
            window.lxpc.closewnd();
        } else {

            if (video_role == 0) {//视频通话主叫或是视频会议发起者 退出视频通话或视频会议
                var parm = {userUniId: initData.dialogId, callType: callType};
                CancelVideoCall(parm)
                TerminateVideoConf()
            } else if (video_role == 2) {
                var parm = {dialogId: initData.meetingQunId, juFengId: confId};
                VideoMeetingOver(parm);
                if (initData.meetingQunId) {
                    TerminateVideoConf(function () {
                        if (initData.isXP) {
                            var parm = {title: '蓝信', text: '视频会议已结束，您是否要解散视频会议群？'}
                            ConfirmMsgBox(parm).then(function (data) {
                                if (data == '0') {//同意
                                    var parm = {qunId: parseFloat(qunId), orgDomain: initData.orgDomain}
                                    DismissQun(parm).then(function (data) {
                                        if (data === 0) {
                                            window.lxpc.closewnd();
                                        }
                                    })
                                } else {
                                    window.lxpc.closewnd();
                                }
                            })
                        } else {
                            my_layer({message: '视频会议已结束，您是否要解散视频会议群？'}, 'confirm', function () {
                                var parm = {qunId: parseFloat(qunId), orgDomain: initData.orgDomain}
                                DismissQun(parm).then(function (data) {
                                    if (data === 0) {
                                        window.lxpc.closewnd();
                                    }
                                })
                            }, function () {
                                window.lxpc.closewnd();
                            });
                        }


                    })
                } else {
                    TerminateVideoConf();
                }

            } else {
                TerminateVideoConf();
            }
        }
        clearTimeout(timer)
    }


    //获取群成员信息
    function getQunMemberInfo(parm) {
//        var parm = {dialogId: dialogId, orgDomain: initdata.orgDomain}
        var promise = new Promise(function (resolve, reject) {
            try {
                //var parm={dialogId:'23123',userUniId:'12131232'}//查询用户的ID（如果不传此字段，就返回这个群的所有用户信息）”｝

                window.lxpc.exebusinessaction('QunCard', 'GetQunMemberInfo', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {

                    if (status == 0) {

                        var result = JSON.parse(jsondata)
                        resolve(result)

                    } else {

                        my_layer({message: '网络异常'}, 'warn')
                        reject(status)
                    }

                })
            }
            catch (e) {
                my_layer({message: '调取接口出错，错误码：' + e.message}, 'error')
                reject(e.message)

            }

        })

        return promise


    }

    // 接受回调
    //2．	接收ReceiveVideoConfStatus状态回调
    function ReceiveVideoConfStatus(data) {
        console.log('ReceiveIframeWebCall1================接收状态回调')
        console.log(data)
        var filter = '.wnd_' + initData.peerWnd,
            $filter = $(filter),
            vdo_l_bac = $filter.find('.vdo_l_bac'),
            video = $filter.find('video'),
            rcallOutD = $filter.find('.vdo_r_callOutD');
        if (data.statusName == 'MtcCallTermedNotification') {//对方断开断开
            vdo_l_bac.show().find('.vdo_tip').html('通话已结束');
            video.hide();
            window.URL.revokeObjectURL(video.attr('src')); // 清除释放
            setTimeout(function () {
                window.lxpc.closewnd();
            }, 2000)
            exitVideo();
            clearTimeout(timer)
            clearInterval(timer_video)
        } else if (data.statusName == 'MtcCallVideoReceiveStatusChangedNotification') {
            if (data.statusParam.MtcCallVideoStatusKey == 0x636F6666) {//关闭摄像头
                callType = 2
                vdo_l_bac.show();
                vdo_l_bac.find('.vdo_tip').html('语音中')
                video.hide()
                rcallOutD.hide();
            } else {
                if (data.statusParam.MtcCallVideoStatusKey == 0x6E726D6C) {//正常
                    video.show()
                    vdo_l_bac.hide();
                    callType = 1
                }
            }
        } else if (data.statusName == 'NotifyCancelledVideoCall') {//监听视频在接通之前对方挂断
            clearTimeout(timer)
            if (data.statusParam.callType == 0) {
                vdo_l_bac.find('.vdo_tip').html('已取消视频通话')
            }
            if (!exitVideoIsManual) {
                if (video_role == 0) {

                }
            }

            setTimeout(function () {
                window.lxpc.closewnd();
            }, 3000)
            clearInterval(timer_video)
        } else if (data.statusName == 'closeWnd') {//菜单栏关闭蓝信程序使得推出视频
            // if (initData.isXP) {
            //     var parm = {title: '蓝信', text: '您确定要退出此次视频通话？'}
            //     ConfirmMsgBox(parm).then(function (data) {
            //         exitVideoIsManual = true
            //         if (data == '0') {//同意
            //             exitVideo()
            //         }
            //     })
            // }else{
            //     my_layer({message: '您确定要退出此次视频通话？'}, 'confirm', function () {
            //         exitVideoIsManual = true
            //         exitVideo()
            //     })
            // }
            layOutMsgBOx()

        } else if (data.statusName == 'preCloseWnd') {//切换组织是关闭视频弹窗

            exitVideoIsManual = true
            exitVideo();
        } else if (data.statusName === 'NotifyFinishedVideoMeeting') {//群视频会议群主退出
            if (video_role === 3) { // 被叫
                TerminateVideoConf();
            }
        }
        else if (data.statusName === 'MtcConfDidLeaveNotification') {// 主持人剔除当前用户
            if (video_role === 3) { // 被叫
                TerminateVideoConf();
            }
        } else if (data.statusName == 'MtcConfErrorNotification') {// 菊峰出问题
            if (video_role == 2) {//主叫
                var parm = {dialogId: initData.meetingQunId, juFengId: confId};
                VideoMeetingOver(parm);
            }
            TerminateVideoConf();
        }
    }

    // 解散该群
    function DismissQun(parm) {
        console.log('解散群参数=========', parm)
        return new Promise(function (resolve, reject) {
            try {

                window.lxpc.exebusinessaction('QunCard', 'DismissQun', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                    console.log('解散群========', status)
                    resolve(status)
                })
            }
            catch (e) {
                reject(e.message)
            }
        })

    }

    /**
     * 控制视频会议成员
     * @returns {Promise}
     * @constructor
     */
    function ControlConfMember(parm) {
//        var parm ={action:'stop/start',ctrlType:'video/audio/kick',userUniId:''}
        console.log('控制视频会议成员参数=========', parm)
        return new Promise(function (resolve, reject) {
            try {

                window.lxpc.exebusinessaction('VideoConf', 'ControlConfMember', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                    console.log('控制视频会议成员========', status)
                    resolve(status)
                })
            }
            catch (e) {
                reject(e.message)
            }
        })
    }

    // 要求成员加入到当前视频会议’
    function InvateVideoMeetingMember(parm) {
        console.log('要求成员加入到当前视频会议========参数', parm)
//        var parm={qunId:'',userUniIdList:[],invitedGroups:[],recordDomain:'',juFengId:'',passwd:''}
        return new Promise(function (resolve, reject) {
            try {

                window.lxpc.exebusinessaction('VideoConf', 'InvateVideoMeetingMember', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {

                    if (status == 0) {
                        resolve(JSON.parse(jsondata || 'null'));

                    } else {
                        reject(status)
                    }

                })
            }
            catch (e) {
                reject(e.message)
            }
        })
    }

    // 视频会议参与者对主持人的响应
    function ReceiveNotifyResponseVideoMeeting() {
        try {
            window.lxpc.exebusinessaction('VideoConf', 'ReceiveNotifyResponseVideoMeeting', '0', JSON.stringify({}), 0, function (status, jsondata, targ) {
                if (status == 0) {
                    console.log('ReceiveNotifyResponseVideoMeeting========================', jsondata);
                    var data = JSON.parse(jsondata);

                    var tip = '',
                        rtip = '未接听',
                        opCode = data.opCode.toString();
                    if (opCode === '0') {
                        return;
                    }
                    switch (opCode) {
                        case '1':
                            tip = '对方已拒绝'
                            rtip = '已挂断'
                            break;
                        case '2':
                            tip = '未接听'
                            break;
                        case '3':
                            tip = '请求超时';
                            rtip = '超时'
                            break;
                        case '4':
                            tip = '占线'
                            rtip = '占线'
                            break;
                        case '5':
                            tip = '设备不支持'
                            break;
                        case '6':
                            tip = '版本不支持'
                            rtip = '超时'
                            break;
                        default:
                            tip = '未知错误'
                            break;
                    }
                    if (opCode !== "0") { // 未接通
                        var vdeo_out = $('.vdo_out[uniid="' + data.userUniId + '"]');
                        vdeo_out.find('.vdo_r_callOutD').html(tip)
                        var vdo_parent = vdeo_out.parents('.vdo_lD')
                        setTimeout(function () {
                            vdo_parent.remove();
                        }, 2000);
                        var $li = $('.vdo_rL_tabC li[uniid="' + data.userUniId + '"]');
                        if ($li.length > 0) {
                            if (hasJoinList[data.userUniID]) {
                                $('#vdo_notConnect').append($li);
                                JoinCount--;
                                notJointCount++;
                                audioCount--;
                                videoCount--;
                                var videoRoleId = videoRoleList.indexOf(data.userUniId)
                                if (videoRoleId > -1) videoRoleList.splice(videoRoleId, 1)
                                var audioRoleId = audioRoleList.indexOf(data.userUniId);
                                if (audioRoleId > -1) audioRoleList.splice(audioRoleId, 1);
                                if (mainVideo === data.userUniId) setMainVideo();

                                $('#vdo_btn_Count').html(JoinCount)
                                $('#connectCount').html(JoinCount)
                                $('#notConnectCount').html(notJointCount);
                                hasJoinList[data.userUniID] = null;
                            }
                            $li.removeClass('recalling').find('.vdo_noReceive_tip').html(rtip);
                        }
                    }
                } else {
                }
            })
        } catch (e) {
            console.log(e.message)
        }
    }

    //通知页面title发生变化
    function ModifyWindowTitle(parm) {
        // var parm={Title:''}
        try {
            window.lxpc.exebusinessaction('VideoConf', 'ModifyWindowTitle', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                if (status == 0) {

                }
                else {
                    console.log(status)
                }
            })
        } catch (e) {
            console.log(e.message)
        }


    }

    //Xp系统web是否显示管理员列表
    function ShowConfMemberList(parm) {
        try {
            window.lxpc.exebusinessaction('VideoConf', 'ShowConfMemberList', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {

            })
        } catch (e) {
            console.log(e.message)
        }
    }

    // XP 下切换窗口接口
    function SwitchVideoWindow() {
        try {
            window.lxpc.exebusinessaction('VideoConf', 'SwitchVideoWindow', '0', JSON.stringify({}), 0, function (status, jsondata, targ) {
                if (status == 0) {
                    var data = JSON.parse(jsondata);
                    var uniId = data.userUniId;
                    if (mainVideo != '' && mainVideo !== uniId) {

                        var $li = $('#vdo_connecting li[uniid="' + uniId + '"]');
                        var $li_main = $('#vdo_connecting li:first');
                        var tem = $li.clone(true);
                        $li.replaceWith($li_main);
                        $li.remove();
                        mainVideo = uniId;
                        $('#vdo_connecting').prepend(tem);
                    } else {
                        mainVideo = uniId;
                    }
                }
            })
        } catch (e) {
            console.log(e.message)
        }
    }
</script>