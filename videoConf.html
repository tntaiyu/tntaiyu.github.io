<!DOCTYPE>
<html xmlns="http://www.w3.org/1999/xhtml">
<head width="915" height="516">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="msapplication-tap-highlight" content="no">


    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=8">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">


    <!--<meta http-equiv="pragma" content="no-cache">-->
    <!--<meta http-equiv="cache-control" content="no-cache">-->
    <!--<meta http-equiv="expires" content="0">-->
    <title>正在视频通话</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css"/>    <!--通用-->
    <link rel="stylesheet" type="text/css" href="css/common.css"/>    <!--通用-->
    <link rel="stylesheet" type="text/css" href="css/video.css"/>    <!--视频-->
    <link rel="stylesheet" type="text/css" href="css/powerange.css"/>    <!--音量-->
    <link rel="stylesheet" type="text/css" href="css/layer.css">  <!-- 弹窗-->
    <script type="text/javascript" src="js/jQuery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/iscroll-5.1.3.min.js"></script>    <!--滚动条-->
    <script type="text/javascript" src="js/powerange.min.js"></script>        <!--音量-->
    <script type="text/javascript" src="js/my_layer.js"></script> <!--弹窗-->
    <script type="text/javascript" src="js/application.js"></script>
    <script type="text/javascript" src="js/xss.min.js"></script>
    <style>
        video {
            /*object-fit:fill;*/
            object-fit: cover;
        }

    </style>
    <script>
        //左侧视频的高度：宽/高=1.333333
        function autoHeight() {
            var h100 = $(".vdo_l").height();	//100%
            var h = h100 / 4 - 1;					//25%-1px，获取单个视频的高度
            var w = h * 1.33333;				//视频的宽度

            $(".vdo_lD").css({width: w, height: h});	//左侧视频的宽 高
            $(".vdo_r").css({left: w + 1});				//右侧视频定位左侧距离
        }
        $(function () {
            autoHeight();
            $(window).resize(autoHeight);
        })
        var myscroll3 = null;
        //控制音量
        $(function () {

//音量
            var initVert = null;
            var vert = document.querySelector('.js-vertical');
            $('.volume_con').hover(function () {
                $('.volume_div').show()
                if (!initVert) {
                    initVert = new Powerange(vert, {start: 80, vertical: true});

                }

            }, function () {
                $('.volume_div').hide()
            })

            $('.volume_plus').bind('click', function () {//增加声音

                var value = isNaN(vert.value) ? 0 : parseInt(vert.value)
                var option = initVert.options;
//                var value=parseInt(vert.value)
                if (value == option.max)return;

                var slider = initVert.slider;
                var handel = initVert.handle;
                var obtm = slider.querySelector('.range-quantity')
                var step = (initVert.slider.offsetHeight - handel.offsetHeight) / (option.max - option.min);
                var newVal = value + (option.step || 5)

                if (newVal >= option.max) {
                    newVal = option.max;
                }
                vert.value = newVal;
                handel.style.bottom = newVal * step + 'px';
                obtm.style.height = newVal * step + 'px';

                var audioInputId = initData.audioInputId
                var volume = newVal
                if (audioInputId) {
                    var parm = {action: "volume", audioInputId: audioInputId, volumePercent: volume}
                    ControlAudio(parm).then(function (data) {

                    })
                }

            })
            $('.volume_minus').bind('click', function () {//减少声音
                vert.value ? vert.value : 0
                var option = initVert.options;
                var value = parseInt(vert.value)
                if (value == option.min)return;

                var slider = initVert.slider;
                var handel = initVert.handle;
                var obtm = slider.querySelector('.range-quantity')

                var newVal = value - (option.step || 5)
                var step = (initVert.slider.offsetHeight - handel.offsetHeight) / (option.max - option.min);
                if (newVal <= option.min) {
                    newVal = option.min;
                }
                vert.value = newVal;
                handel.style.bottom = newVal * step + 'px';
                obtm.style.height = newVal * step + 'px'

                var audioInputId = initData.audioInputId
                var volume = newVal
                if (audioInputId) {
                    var parm = {action: "volume", audioInputId: audioInputId, volumePercent: volume}
                    ControlAudio(parm).then(function (data) {

                    })
                }


            })
            vert.onchange = function () {
                var clum = parseFloat(this.value);
                var audioInputId = initData.audioInputId
                var volume = clum
                if (audioInputId) {
                    var parm = {action: "volume", audioInputId: audioInputId, volumePercent: volume}
                    ControlAudio(parm).then(function (data) {

                    })
                }

            }

            //右侧成员列表 显示/隐藏
            $(".vdo_btn_member").click(function () {
                var opacity = $('.vdo_rList').css('opacity');
                if (opacity == '0') {
                    $(".vdo_rList").css({opacity: "1", right: "0"})
                    $(this).addClass("on");
                } else {
                    $(".vdo_rList").css({opacity: "0", right: "-246px"})
                    $(this).removeClass("on");
                }
            })

            //主持人-右侧参会人员tab切换
            $(".vdo_rL_tTab a").each(function (index) {
                $(this).click(function () {
                    //右侧 默认（背景图标）
                    $(".vdo_rL_tCon").addClass("disN")
                    $(".vdo_rL_tCon:eq(" + index + ")").removeClass("disN")

                    $(".vdo_rL_tTab a").removeClass("on")
                    $(this).addClass("on")
                    myscroll3.refresh();
                })
            })

            //主持人-点击右侧按钮
            //麦克风
            $(".vdo_rL_aMute").click(function () {
                if ($(this).is('.on')) {
                    $(this).removeClass('on');
                    $(this).attr("title", "点击禁言");
                } else {
                    $(this).addClass('on');
                    $(this).attr("title", "恢复通话");
                }
            })
            //摄像头
            $(".vdo_rL_aVideo").click(function () {
                if ($(this).is('.on')) {
                    $(this).removeClass('on');
                    $(this).attr("title", "关闭视频");
                } else {
                    $(this).addClass('on');
                    $(this).attr("title", "打开视频");
                }
            })
        })

        //缺少设备 显示/隐藏
        $(function () {

//静音
            $(".vdo_btn_mic").click(function () {


                if (this.classList.contains('no')) {
                    return
                }
                var $ele = $(this)
                var redo = $ele.data('redo');
                if (redo) {
                    return
                } else {
                    $ele.data('redo', true)
                }

                closeOrOpen(this)
                var audioInputId = initData.audioInputId
                if (audioInputId) {
                    var isOff = false
                    if (this.classList.contains('on')) {
                        var parm = {action: "stop", audioInputId: audioInputId}
                        isOff = true
                        this.title = '打开麦克风'
                    } else {
                        var parm = {action: "start", audioInputId: audioInputId}
                        this.title = '关闭麦克风'
                    }

                    ControlAudio(parm).then(function (data) {
                        if (data == 0) {
                            $ele.data('redo', false);
                            if (isOff) {
//                                $('.mySelf').parents('.vdo_lD').find('.vdo_l_bac').hide()
                                $('.mySelf').find('.vdo_l_mute ').show()
                            } else {
                                $('.mySelf').find('.vdo_l_mute ').hide()
                            }
                        }

                    })
                }


            })
            //关闭视频
            $(".vdo_btn_camera").click(function () {
                if (this.classList.contains('no')) {
                    return
                }

                var $ele = $(this)
                var redo = $ele.data('redo');
                if (redo) {
                    return
                } else {
                    $ele.data('redo', true)
                }

                closeOrOpen(this);
                var isOff = false;
                if (this.classList.contains('on')) {
                    var parm = {
                        action: "stop",
                        wnd: initData.ownerWnd,
                        videoId: initData.videoId,
                        sessionId: initData.sessionId
                    }
                    isOff = true
                    type = 1
                    this.title = '打开摄像头'
                } else {
                    var parm = {
                        action: "start",
                        wnd: initData.ownerWnd,
                        videoId: initData.videoId,
                        sessionId: initData.sessionId
                    }
                    isOff = false
                    type = 0
                    this.title = '关闭摄像头'
                }

                ControlVideo(parm).then(function (data) {

                    if (data == 0) {
                        var $tem = $(".vdo_btn_camera")
                        $tem.data('redo', false);
                        var $mySelf = $('.mySelf')
                        if (isOff) {
                            $mySelf.find('.vdo_l_bac').show();
                            $mySelf.find('video').hide();
                        } else {
                            $mySelf.find('.vdo_l_bac').hide()
                            $mySelf.find('video').show();
                        }

                    }

                })
            })


            //调节音量
            $(".vdo_btn_mute").click(function () {
                closeOrOpen(this)

            })
            //设置
            $(".vdo_btn_set").click(function (e) {
                $(".vdo_set").toggle();
                var e = e || window.event; //浏览器兼容性
                e.stopPropagation()
            })

            $(document).bind('click', function (e) {
                $(".vdo_set").hide();
                var e = e || window.event; //浏览器兼容性
                var elem = e.target || e.srcElement;
                while (elem) {
                    if (elem.id && elem.id == 'vdo_btn_lack') {
                        return;
                    }
                    if (elem.id && elem.id == 'vdo_btn_lD') {
                        return;
                    }
                    if (elem.id && elem.id == 'vdo_btn_camera') {
                        return;
                    }
                    if (elem.id && elem.id == 'vdo_btn_mute') {
                        return;
                    }
                    if (elem.id && elem.id == 'vdo_btn_mic') {
                        return;
                    }
                    elem = elem.parentNode;
                }
                var lackH = $(".vdo_btn_lD").outerHeight();
                $(".vdo_btn_lD").css({
                    opacity: "0",
                    bottom: -lackH
                })


            });
//点击显示设备情况
            var lackH = $(".vdo_btn_lD").outerHeight();	//获取向上滑动弹出框动画的高度
            $(".vdo_btn_l").hover(function (e) {

//                var opacity =$('.vdo_btn_lD').css('opacity');
//                if(opacity == '0'){
//                    $(".vdo_btn_lD").css({opacity:"1",bottom: "38px"})
//                }else{
//                    $(".vdo_btn_lD").css({opacity:"0",bottom: -lackH})
//                }
                $(".vdo_btn_lD").css({opacity: "1", bottom: "38px"})
                e.stopPropagation()
            }, function (e) {
                $(".vdo_btn_lD").css({opacity: "0", bottom: -lackH})
                e.stopPropagation()
            })
//更改状态
            function closeOrOpen(ele) {
                if (!ele.classList.contains('on')) {//
                    ele.classList.add('on')
                } else {
                    ele.classList.remove('on')
                }
            }
        })

        //退出
        $(function () {
            $(".vdo_btn_quit").click(function () {

                my_layer({message: '您确定要退出此次视频通话？'}, 'confirm', function () {
                    TerminateVideoConf()
                })

            })
        })

        //邀请-弹出框
        $(function () {
            $(".vdo_iHint_close").click(function () {
                $(this).parents(".vdo_invite_hint").remove();
            })
            $(".vdo_invite_b a").click(function () {
                $(this).parents(".vdo_invite").remove();
            })
        })

        //设置
        $(function () {

            $(".vdo_set_close").click(function () {
                $(this).parents(".vdo_set").hide();
            })
        })

        //设置设备
        $(function () {
            document.onclick = function () {
                $(".vdo_drop_ModifyThe").removeClass("vdo_drop_aB")
                $(".vdo_drop_list").hide();
            };
            $('.vdo_set').click(function (event) {
                $('.vdo_drop_list').hide();
                $('.vdo_drop_aB').removeClass('vdo_drop_aB')
                var e = window.event || event;
                if (e.stopPropagation) {
                    e.stopPropagation();
                } else {
                    e.cancelBubble = true;
                }

            })

            $('.vdo_drop').click(function (event) {

                var $ele = $(this);
//                if ($ele.hasClass('vdo_drop_MNo')) {
//                    return
//                }
//                $('.vdo_drop_list').hide()


                $ele.find('.vdo_drop_list').toggle();
                $ele.find('.vdo_drop_ModifyThe ').toggleClass("vdo_drop_aB")

                var vdo_set = $ele.parents('.vdo_set_li').siblings()
                vdo_set.find('.vdo_drop_list').hide();
                vdo_set.find('.vdo_drop_aB').removeClass('vdo_drop_aB');
                var e = window.event || event;
                if (e.stopPropagation) {
                    e.stopPropagation();
                } else {
                    e.cancelBubble = true;
                }
            });


        })


        //滚动条
        $(function () {
            loaded();
        })
        function loaded() {
            var option = {
                probeType: 2,
                scrollbars: "custom",
                mouseWheel: true,
                bounce: false,
                interactiveScrollbars: true,
                shrinkScrollbars: 'scale',
                preventDefault: false
            };
//            var myscroll = new IScroll('#wrapper', option);
//            var myscroll2 = new IScroll('#wrapper2', option);
            myscroll3 = new IScroll('#wrapper3', option);
//            var myscroll4 = new IScroll('#wrapper4', option);
        }
    </script>
    <!--<script type="application/javascript" src="./js/videoConf.js"></script>-->
</head>

<body class="shadow">

<script>
    if (navigator.userAgent.indexOf('Mac OS X') > -1) {
        $('body').addClass('mac')
    } else {
        $('body').addClass('pc')
    }
</script>
<div class="out_box">

    <!--视频-->
    <div class="vdo_main">
        <div class="vdo_con">
            <div class="vdo_l" id="wrapper">
                <div class="scroll">
                    <div class="vdo_lD " onclick="changeVideo(this)">

                        <!--<div class="vdo_l_video">-->

                        <!--</div>-->
                        <div class="vdo_out">
                            <video src="" class="vdo_l_video" autoplay>

                            </video>
                            <div class="vdo_l_bac disN">
                                <div class="vdo_tip ">语音中</div>
                                <div class="vdo_lBg_btn"></div>

                            </div>
                            <i class="vdo_l_mute disN"></i>
                            <div class="vdo_lD_b">我</div>

                        </div>


                    </div>
                </div>
            </div>
            <div class="vdo_r">
                <!--<div class="vdo_r_callOut">-->
                <!--<div class="vdo_r_callOutD">正在呼叫…</div>-->
                <!--</div>-->
                <div class=" vdo_out">
                    <video class="vdo_r_callOut" autoplay>

                    </video>
                    <!--<div class="vdo_r_voC disN">-->
                    <!--<i class="vdo_r_voCBtn"></i>-->
                    <!--<p>语音中</p>-->
                    <!--</div>-->
                    <div class="vdo_l_bac disN">
                        <div class="vdo_tip ">语音中</div>
                        <div class="vdo_lBg_btn"></div>
                    </div>

                    <div class="vdo_r_t">
                        <h3 class="main_name">赵晨威</h3>
                        <p class="main_branch">企业安全-产品部</p>
                    </div>
                    <i class="vdo_l_mute disN"></i>
                    <div class="vdo_r_callOutD">正在呼叫…</div>
                </div>


                <div class="vdo_rList disN" style="opacity: 1; right: 0px;">
                    <!--参会人员-->
                    <!--<div class="PA42 disN">-->
                    <!--<div class="vdo_rL_tTit ">已加入(5)</div>-->
                    <!--</div>-->
                    <div class="PA88">
                        <div class="vdo_rL_tBtn"><a href="javascript:;"><i></i>可邀请20人</a></div>
                        <div class="vdo_rL_tTab">
                            <ul>
                                <li><a href="javascript:;" class="on">已接通(5)</a></li>
                                <li><a href="javascript:;">未接通(1)</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="vdo_rL_tabC" id="wrapper3">
                        <div class="vdo_rL_tCon ">
                            <ul class="vdo_rL_list">
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo" title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>莉莉(主持人)</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>李成伟</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i class="vdo_rL_iVideo"
                                                                                          title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>王月</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>巍巍</p></li>
                                <li><span class="vdo_rL_lBtn"><a href="javascript:;" class="vdo_rL_aConnect on"
                                                                 title="挂断"></a><a href="javascript:;"
                                                                                   class="vdo_rL_aMute"
                                                                                   title="点击禁言"></a><a
                                        href="javascript:;" class="vdo_rL_aVideo" title="关闭视频"></a></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo" title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>莉莉(主持人)</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>李成伟</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i class="vdo_rL_iVideo"
                                                                                          title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>王月</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>巍巍</p></li>
                                <li><span class="vdo_rL_lBtn"><a href="javascript:;" class="vdo_rL_aConnect on"
                                                                 title="挂断"></a><a href="javascript:;"
                                                                                   class="vdo_rL_aMute"
                                                                                   title="点击禁言"></a><a
                                        href="javascript:;" class="vdo_rL_aVideo" title="关闭视频"></a></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo" title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>莉莉(主持人)</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>李成伟</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i class="vdo_rL_iVideo"
                                                                                          title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>王月</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>巍巍</p></li>
                                <li><span class="vdo_rL_lBtn"><a href="javascript:;" class="vdo_rL_aConnect on"
                                                                 title="挂断"></a><a href="javascript:;"
                                                                                   class="vdo_rL_aMute"
                                                                                   title="点击禁言"></a><a
                                        href="javascript:;" class="vdo_rL_aVideo" title="关闭视频"></a></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo" title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>莉莉(主持人)</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>李成伟</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i class="vdo_rL_iVideo"
                                                                                          title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>王月</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>巍巍</p></li>
                                <li><span class="vdo_rL_lBtn"><a href="javascript:;" class="vdo_rL_aConnect on"
                                                                 title="挂断"></a><a href="javascript:;"
                                                                                   class="vdo_rL_aMute"
                                                                                   title="点击禁言"></a><a
                                        href="javascript:;" class="vdo_rL_aVideo" title="关闭视频"></a></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo" title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>莉莉(主持人)</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>李成伟</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i class="vdo_rL_iVideo"
                                                                                          title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>王月</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>巍巍</p></li>
                                <li><span class="vdo_rL_lBtn"><a href="javascript:;" class="vdo_rL_aConnect on"
                                                                 title="挂断"></a><a href="javascript:;"
                                                                                   class="vdo_rL_aMute"
                                                                                   title="点击禁言"></a><a
                                        href="javascript:;" class="vdo_rL_aVideo" title="关闭视频"></a></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo" title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>莉莉(主持人)</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>李成伟</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i class="vdo_rL_iVideo"
                                                                                          title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>王月</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>巍巍</p></li>
                                <li><span class="vdo_rL_lBtn"><a href="javascript:;" class="vdo_rL_aConnect on"
                                                                 title="挂断"></a><a href="javascript:;"
                                                                                   class="vdo_rL_aMute"
                                                                                   title="点击禁言"></a><a
                                        href="javascript:;" class="vdo_rL_aVideo" title="关闭视频"></a></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo" title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>莉莉(主持人)</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>李成伟</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i class="vdo_rL_iVideo"
                                                                                          title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>王月</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>巍巍</p></li>
                                <li><span class="vdo_rL_lBtn"><a href="javascript:;" class="vdo_rL_aConnect on"
                                                                 title="挂断"></a><a href="javascript:;"
                                                                                   class="vdo_rL_aMute"
                                                                                   title="点击禁言"></a><a
                                        href="javascript:;" class="vdo_rL_aVideo" title="关闭视频"></a></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                            </ul>
                        </div>
                        <div class="vdo_rL_tCon disN">
                            <ul class="vdo_rL_list">
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo" title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>莉莉(主持人)11111111111</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute" title="音频已被开启"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>李成伟111111111111111</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i class="vdo_rL_iVideo"
                                                                                          title="视频已被开启"></i></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威11111111111111</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>王月1111111111</p></li>
                                <li><span class="vdo_rL_lBtn2"><i class="vdo_rL_iMute on"
                                                                  title="主持人未开启音频"></i><i
                                        class="vdo_rL_iVideo on" title="主持人未开启视频"></i></span><img
                                        src="images/card_icon.png">
                                    <p>巍巍111111111111</p></li>
                                <li><span class="vdo_rL_lBtn"><a href="javascript:;" class="vdo_rL_aConnect on"
                                                                 title="挂断"></a><a href="javascript:;"
                                                                                   class="vdo_rL_aMute"
                                                                                   title="点击禁言"></a><a
                                        href="javascript:;" class="vdo_rL_aVideo" title="关闭视频"></a></span><img
                                        src="images/card_icon.png">
                                    <p>赵晨威</p></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="vdo_btn">
            <div class="vdo_btn_c">
                <a href="javascript:;" class="vdo_btn_mic " id="vdo_btn_mic" title="关闭麦克风"><i></i></a>
                <a href="javascript:;" class="vdo_btn_camera " id="vdo_btn_camera" title="关闭摄像头"><i></i></a>
                    <span class="volume_con">
                    <a href="javascript:;" class="vdo_btn_mute " id="vdo_btn_mute" title="点击静音"><i></i></a>
        <div class="volume_div">
            <div class="vdo_btn_muteIpt"><em class="volume_btn volume_plus"></em>
                <div class="slider-wrapper vertical-wrapper"><input type="text" class="js-vertical"/></div>
                <em class="volume_btn volume_minus"></em>
            </div>
        </div>
                    </span>
                <a href="javascript:;" class="vdo_btn_set" title="设置"><i></i></a>
                <a href="javascript:;" class="vdo_btn_member on " style="display: none"><i></i><em>5/6</em></a>
            </div>
            <div class="vdo_btn_r"><a href="javascript:;" class="vdo_btn_quit"><i></i>退出</a></div>
            <div class="vdo_btn_l disN">
                <a href="javascript:;" class="vdo_btn_lack" id="vdo_btn_lack"><i></i>缺少设备</a>
                <div class="vdo_btn_lD" id="vdo_btn_lD"><h4>未检测到摄像头、话筒、扬声器</h4>
                    <p>请确定设备已插入并安装最新驱动，或其他程序正在占用此设备。</p></div>
            </div>
        </div>
    </div>

    <!--设置-弹出框-->
    <div class="vdo_set ">
        <h4 class="vdo_set_title"><a href="javascript:;" class="vdo_set_close"></a>设置</h4>
        <div class="vdo_set_con">
            <div class="vdo_set_list">
                <div class="vdo_set_li">
                    <label class="vdo_set_l">摄像头选择</label>
                    <div class="fl  set_camera">
                        <div class="vdo_drop set1">
                            <div title="Windows默认设备" class="vdo_drop_ModifyThe vdo_drop_M0">
                                <i></i><span>Windows默认设备</span>
                            </div>
                            <ul class="vdo_drop_list vdo_drop_l0">
                                <!--<li title="Windows默认设备">Windows默认设备</li>-->
                                <!--<li title="扬声器(Realtek High Ddfinition Audio)">扬声器<i class="vdo_drop_lI">(Realtek-->
                                    <!--High Ddfinition Audio)</i></li>-->
                                <!--<li title="禁用">禁用</li>-->
                            </ul>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>
                <div class="vdo_set_li">
                    <label class="vdo_set_l">麦克风选择</label>
                    <div class="fl  set_mic">
                        <div class="vdo_drop set2">
                            <!--<div title="没有麦克风设备" class="vdo_drop_ModifyThe vdo_drop_M1 disN"><i></i><span>没有麦克风设备</span>-->
                            <!--</div>-->
                            <div title="Windows默认设备" class="vdo_drop_ModifyThe vdo_drop_M1">
                                <i></i><span>Windows默认设备</span></div>
                            <ul class="vdo_drop_list vdo_drop_l1">
                                <!--<li title="Windows默认设备">Windows默认设备</li>-->
                                <!--<li title="扬声器(Realtek High Ddfinition Audio)">扬声器<i class="vdo_drop_lI">(Realtek-->
                                    <!--High Ddfinition Audio)</i></li>-->
                                <!--<li title="禁用">禁用</li>-->
                            </ul>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>
                <div class="vdo_set_li">
                    <label class="vdo_set_l">扬声器选择</label>
                    <div class="fl ">
                        <div class="vdo_drop set3">
                            <!--<div title="没有扬声器设备" class="vdo_drop_ModifyThe vdo_drop_M2 disN"><i></i><span>没有扬声器设备</span>-->
                            <!--</div>-->
                            <div title="Windows默认设备" class="vdo_drop_ModifyThe vdo_drop_M2">
                                <i></i><span class="">Windows默认设备</span></div>
                            <ul class="vdo_drop_list vdo_drop_l2">
                                <!--<li title="Windows默认设备">Windows默认设备</li>-->
                                <!--<li title="扬声器(Realtek High Ddfinition Audio)">扬声器<i class="vdo_drop_lI">(Realtek-->
                                    <!--High Ddfinition Audio)</i></li>-->
                                <!--<li title="禁用">禁用</li>-->
                            </ul>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--邀请-弹出框-->
<div class="vdo_invite  disN">
    <div class="vdo_invite_hint disN"><a href="javascript:;" class="vdo_iHint_close"></a><i
            class="vdo_iHint_mark"></i>未检测到扬声器、话筒，请检查设备或用手机发起
    </div>
    <div class="vdo_invite_con">
        <div class="vdo_invite_t">
            <img src="images/card_icon.png"/>
            <div class="vdo_invite_tR">
                <h4><span class="main_name">赵晨威</span><span>邀请你进入视频会议</span></h4>
                <p class="main_branch">蓝信移动-产品部</p>
            </div>
        </div>
        <div class="vdo_invite_b">
            <a href="javascript:;" class="vdo_iB_btn vdo_iB_btn1">拒绝</a>
            <a href="javascript:;" class="vdo_iB_btn vdo_iB_btn2"><i></i>接听</a>
            <a href="javascript:;" class="vdo_iB_bZ">语音接听</a>
        </div>
    </div>
</div>

</div>

</body>
</html>

<script>
    var initData = null, confId = 0, senderId = -1, type = 0, imgList = {},settinginfos={};

    $(function () {

        var parm = {};

        navigator.getUserMedia = navigator.webkitGetUserMedia || navigator.getUserMedia

        try {

            window.lxpc.exebusinessaction('extend', 'InitFinished', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {

                if (status == 0) {

                    var tmpdata = JSON.parse(jsondata);
                    initData = JSON.parse(jsondata);
console.log(initData)
                    var peerDialogId = tmpdata['dialogId']
                    var nflag = tmpdata['flag']
                    var tmpparm = {userUniId: peerDialogId};

                    if (nflag == 'qun_videomeetingcaller' || nflag == 'to_be_videomeetingcalled') {//发起群会议
                        qunVideoConf(nflag)
                    } else {
                        initSetting();

                        if (nflag == 'videocaller') {//个人发起
                            $('.vdo_invite').hide()

                            VideoCall(tmpparm)
                            openMedia();
                        } else {//个人被叫

                            $('.vdo_invite').show();
                            $('.vdo_iB_btn1')[0].onclick = function () {//拒绝接听

                                var parm = {userUniId: peerDialogId, opCode: '1'}
                                ResponseVideoCall(parm)
                                return;
                            }
                            $('.vdo_iB_btn2')[0].onclick = function () {//接听
                                openMedia();
                                var parm = {userUniId: peerDialogId, opCode: '0'}
                                ResponseVideoCall(parm)//相应被叫

                            }

                            $('.vdo_iB_bZ').click(function () {//语音接听

                                type = 1;

                                $('.vdo_btn_camera').addClass('on')
                                var parm = {userUniId: peerDialogId, opCode: '0'}
                                ResponseVideoCall(parm)//相应被叫
                                openMedia();
                                var myvideo = $('.vdo_l .vdo_out');

                                myvideo.find('.vdo_l_bac').show()
                                myvideo.find('video').hide()
                                $('.vdo_r_callOutD').html('视频连接中...')
                            })

                            ReceiveVideoConfStatus();//注册回调对方对视频会议的操作
                        }
                    }


                    //video call发起


                } else {
                    console.log(status)
                }


            })

        } catch (e) {
            e.message
        }
//注册回调
//接受视频和音频
//        var oplay = document.getElementsByClassName('vdo_l_video')[0]
//        var oplayX = document.getElementsByClassName('vdo_r_callOut')[0];

        ReceiveVideoCallResult();


        TitleTools();
    })


    //发起会议
    function VideoCall(tmpparm) {

        window.lxpc.exebusinessaction('VideoConf', 'VideoCall', '0', JSON.stringify(tmpparm), 0, function (status, jsondata, targ) {
            if (status == 0) {

                var data = JSON.parse(jsondata)
                //0=接受；1=拒绝；2=占线；3=超时;4=不在线;5=不支持（PMC关闭）；6=版本不支持
                if (data.opCode == 0) {
                    var parm = {sendUserUniId: initData.curUserUniID, recUserUniId: initData.dialogId}
//打开麦克风
                    window.lxpc.exebusinessaction('VideoConf', 'VideoMtcCall', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {

                        if (status == 0) {

                        }
                        else {
                            console.log(status)
                        }
                    })

                    ReceiveVideoConfStatus();

                } else {
                    var tip = ''

                    switch (data.opCode) {
                        case '1':
                            tip = '对方已拒绝'
                            break;
                        case '2':
                            tip = '对方占线'
                            break;
                        case '3':
                            tip = '请求超时'
                            break;
                        case '4':

                            tip = '对方不在线'
                            break;
                        case '5':
                            tip = '设备不支持'
                            break;
                        case '6':
                            tip = '版本不支持'
                            break;
                        default:
                            tip = '未知错误'
                            break;
                    }

                    my_layer({message: tip}, 'warn')

                    $('.vdo_r_callOutD').html(tip)
                }

            }
            else {

                console.log(status)
            }
        })


    }

    //响应被叫
    function ResponseVideoCall(tmpparm) {

        window.lxpc.exebusinessaction('VideoConf', 'ResponseVideoCall', '0', JSON.stringify(tmpparm), 0, function (status, jsondata, targ) {
            if (status == 0) {
                console.log('响应被叫------------------')
                console.log(jsondata)

//                var data = JSON.parse(jsondata)


            }
            else {
                console.log(status)
            }
        })
    }


    function playMedia(jsondata) {

//        if (type == 1) {//语音接听
//            var $filter = $('.mySelf');
//            $filter.find('video').hide();
//            $filter.find('.vdo_l_bac').show();
//        }
//        else {
        window.lxpc.exebusinessaction('VideoConf', 'OpenVideo', '0', jsondata, 0, function (status, jsondata, targ) {

            if (status == 0) {

                if (type == 1) {
                    var parm = {
                        action: "stop",
                        wnd: initData.ownerWnd,
                        videoId: initData.videoId,
                        sessionId: initData.sessionId
                    }

                    ControlVideo(parm).then(function (data) {

                    })
                }


            }
            else {
                console.log(status)
            }
        })

//        }


        //open audio
        window.lxpc.exebusinessaction('VideoConf', 'OpenAudio', '0', jsondata, 0, function (status, jsondata, targ) {

            if (status == 0) {

            }
            else {
                console.log(status)
            }
        })
//
//        var parm = {sendUserUniId: initData.curUserUniID, recUserUniId: initData.dialogId}
////打开麦克风
//        window.lxpc.exebusinessaction('VideoConf', 'VideoMtcCall', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
//
//            if (status == 0) {
//
//            }
//            else {
//                console.log(status)
//            }
//        })

    }
    //群会议操作
    function qunVideoConf(ngflag) {
        $('.vdo_rList')
        $('.vdo_btn_member').show();
        if (ngflag == 'qun_videomeetingcaller') {//主叫

            $('.vdo_btn_member').show();
            $('.vdo_invite').hide();
            var parm = {}
            window.lxpc.exebusinessaction('VideoConf', 'GetJusToken', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                if (status == 0) {
                    window.lxpc.exebusinessaction('VideoConf', 'LoginJusTalk', '0', jsondata, 0, function (status, jsondata, targ) {
                        if (status == 0) {
                            //验证视频会议
                            console.log(jsondata)
                            MtcCreateVideoMeeting();
                            var data = JSON.parse(jsondata);
                            initData.ownerWnd = data.ownerWnd;
                            initData.peerWnd = data.peerWnd;
                            initData.videoId = (data.cameraInfo && data.cameraInfo.length > 0) ? data.cameraInfo[0].devId : null;
                            var ownVideo = document.querySelector('.vdo_l_video');

                            bindVideo(data.ownerWnd, ownVideo);

                            $(ownVideo).parents('.vdo_out').addClass('mySelf').data('wnd', data.ownerWnd);
//打开视频和音频
                            playMedia(jsondata)
                            var data = JSON.parse(jsondata)
                            settinginfos=data
                            //绑定获取的可用设备
                            multimediaSeting(data)
                            if (data.audioOutputInfo && data.audioOutputInfo.length > 0) {
                                $('.vdo_invite_hint').hide();
                            } else {
                                $('.vdo_invite_hint').show();
                            }

                        }
                        else {
                            console.log(status)
                        }
                    })
                }
                else {
                    console.log(status)
                }
            })
//            openMedia()
//            //验证视频会议
//            MtcCreateVideoMeeting();

        } else if (ngflag == 'to_be_videomeetingcalled') {//被叫


            $('.vdo_btn_member').hide();
            $('.vdo_invite').show();
            //拒绝
            $('.vdo_iB_btn1')[0].onclick = function () {

                var parm = {
                    dialogId: initData.dialogId,
                    opCode: '1',
                    juFengId: initData.juFengId,
                    userUniId: initData.toUserUniId
                }
                console.log(parm)
                videoQunCalled(parm, 1)
                return;
//                                var parm={userUniId: peerDialogId,opCode:'1'}
//                                ResponseVideoCall(parm)
            }
            //接受
            $('.vdo_iB_btn2')[0].onclick = function () {
                console.log(initData)
                console.log('kkkkkkkkkkkkkkkkkkkk--------------------')
                debugger;
                var parm = {
                    dialogId: initData.dialogId,
                    opCode: '0',
                    juFengId: initData.juFengId,
                    userUniId: initData.toUserUniId
                }
                videoQunCalled(parm, 0)


            }

        }


    }

    //验证视频会议
    function MtcCreateVideoMeeting(parm) {
        var parm = {displayName: '蓝信视频会议', title: '视频会议', password: '123'}

        try {
            window.lxpc.exebusinessaction('VideoConf', 'MtcCreateVideoMeeting', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                if (status == 0) {

                    var data = JSON.parse(jsondata);
//创建群来生成视频会议
                    confId = data.confId

                    var parm1 = {displayName: '蓝信视频会议', juFengId: confId, password: data.password}

                    try {
                        window.lxpc.exebusinessaction('VideoConf', 'MtcJoinVideoMeeting', '0', JSON.stringify(parm1), 0, function (status, jsondata, targ) {
                            if (status == 0) {

                                var parm = {
                                    juFengId: confId,
                                    passwd: data.password,
                                    userUniIdList: initData.userUniIdList,
                                    invitedGroups: initData.invitedGroups
                                };


                                try {
                                    window.lxpc.exebusinessaction('VideoConf', 'CreateVideoMeeting', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                                        if (status == 0) {
                                            console.log('CreateVideoMeeting-----------           ')

                                        } else {

                                        }

                                    })
                                } catch (e) {
                                    console.log(e.message)
                                }

                            }
                        })
                    } catch (e) {
                        console.log(e.message)
                    }


                } else {

                }

            })
        } catch (e) {
            console.log(e.message)
        }
    }
    //接受群的视频会议
    function videoQunCalled(parm, opCode) {

        window.lxpc.exebusinessaction('VideoConf', 'GetJusToken', '0', JSON.stringify({}), 0, function (status, jsondata, targ) {
            if (status == 0) {
                window.lxpc.exebusinessaction('VideoConf', 'LoginJusTalk', '0', jsondata, 0, function (status, jsondata, targ) {
                    if (status == 0) {
//                        ResponseVideoMeeting响应被叫群视频会议
                        console.log('ffffffffffffffffffffffffffffff')
                        console.log(jsondata)

                        if (opCode == 0) {
                            initData.displayName='蓝信视频会议';
                            var parm1 = initData
                            console.log(parm1)
                            try {
                                window.lxpc.exebusinessaction('VideoConf', 'MtcJoinVideoMeeting', '0', JSON.stringify(parm1), 0, function (status, jsondata, targ) {
                                    if (status == 0) {

                                        console.log('ggggggggggggggggggggggggggggggggg---------------------------------')
                                        ResponseVideoMeeting(parm)
                                    }
                                })
                            } catch (e) {
                                console.log(e.message)
                            }
                        } else {
                            ResponseVideoMeeting(parm)
                        }



                        var data = JSON.parse(jsondata);
                        initData.ownerWnd = data.ownerWnd;
                        initData.peerWnd = data.peerWnd;
                        initData.videoId = (data.cameraInfo && data.cameraInfo.length > 0) ? data.cameraInfo[0].devId : null;
                        var ownVideo = document.querySelector('.vdo_l_video');

                        bindVideo(data.ownerWnd, ownVideo);

                        $(ownVideo).parents('.vdo_out').addClass('mySelf').data('wnd', data.ownerWnd);
//打开视频和音频
                        playMedia(jsondata)
                        var data = JSON.parse(jsondata)
                        settinginfos=data
                        //绑定获取的可用设备
                        multimediaSeting(data)
                        if (data.audioOutputInfo && data.audioOutputInfo.length > 0) {
                            $('.vdo_invite_hint').hide();
                        } else {
                            $('.vdo_invite_hint').show();
                        }

                    }
                    else {
                        console.log(status)
                    }
                })
            }
            else {
                console.log(status)
            }
        })
    }
    //ResponseVideoMeeting响应被叫群视频会议
    function ResponseVideoMeeting(parm) {
        try {
            window.lxpc.exebusinessaction('VideoConf', 'ResponseVideoMeeting', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
                if (status == 0) {

                }
                else {
                    console.log(status)
                }
            })
        } catch (e) {
            console.log(e.message)
        }
    }

    //绑定视频信息
    function bindVideo(Handel, oVideo, mainVideo) {
        navigator.getUserMedia({
            audio: false,
            video: {
                mandatory: {
                    chromeMediaSource: 'desktop',
                    chromeMediaSourceId: 'window:' + Handel + ':0',
//                                        minAspectRatio: 1.333, maxAspectRatio: 1.334,
//                                        aspectRatio: 1.3333333333,
//                                        minWidth: 143.333,
//                                        minHeight: 107.5,
//                                        maxWidth: 4000,
//                                        maxHeight: 3000,
//                                        minAspectRatio:1.3333, maxAspectRatio: 1.3334
//                                        aspectRatio: 1.3333333333
                },
                optional: [],
//                                width: {min: 1024, ideal: 1280, max: 1920},
//                                height: {min: 776, ideal: 720, max: 1080}
//                                    width: 108,
//                                    height:143.333,
//                                aspectRatio: 1.3333333333


            }
        }, function (stream) {

            oVideo.load(function (e) {
                window.URL.revokeObjectURL(this.src); // 清除释放

                if (this.classList.contains('vdo_r_callOut')) {
                    var ocall = document.querySelector('.vdo_r_callOutD')
                    ocall.style.display = 'none';
                    oVideo.data('wnd', Handel)
                }
            })

            oVideo.src = window.URL.createObjectURL(stream);

            if (mainVideo) {
                var ocall = document.querySelector('.vdo_r_callOutD')
                ocall.style.display = 'none';
            }
//
        }, function () {

            console.log('Error, Screen stream is not available.')
        })

    }
    //接收视频信息

    function ReceiveVideoCallResult() {
        try {

            window.lxpc.exebusinessaction('VideoConf', 'ReceiveVideoCallResult', '0', JSON.stringify({}), 0, function (status, jsondata, targ) {

                if (status == 0) {

                    var data = JSON.parse(jsondata);
                    window.URL = window.URL || window.webkitURL;


                    console.log('ReceiveVideoCallResult--------------------')
                    console.log('ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff')

//                    var parm = {getImgWnd: data.ownerWnd}
                    initData.peerWnd = data.peerWnd

                    initData.sessionId = data.sessionId//添加新的字段 sesstionId用于关闭和打开视频
                    var peerVideo = document.querySelector('.vdo_r_callOut')
                    bindVideo(data.peerWnd, peerVideo, true)
                    $('.vdo_r .vdo_out').addClass('wnd_' + data.peerWnd);
                } else {
                    console.log(status)
                }
            })
        } catch (e) {
            console.log(e.message)
        }
    }

    //绑定设备信息
    function multimediaSeting(data) {
        var camerli = $('.set1');
        var audioInputli = $('.set2');
        var audioOutputli = $('.set3');

        bindPlayer(data.cameraInfo, camerli, '没有摄像头设备')
        bindPlayer(data.audioInputInfo, audioInputli, '没有麦克风设备')
        bindPlayer(data.audioOutputInfo, audioOutputli, '没有扬声器设备')

        if (data.audioInputInfo.length > 0) {
            initData.audioInputId = data.audioInputInfo[0].devId
        } else {
            initData.audioInputId = null;
        }

        if (data.cameraInfo.length == 0) {
            $('.vdo_btn_camera ').addClass('no')
        } else {
            $('.vdo_btn_camera ').removeClass('no')
        }

        if (data.audioOutputInfo.length == 0) {
            $('.vdo_btn_mic  ').addClass('no')
        } else {
            $('.vdo_btn_mic  ').removeClass('no')
        }

        if (data.cameraInfo.length == 0 || data.audioInputInfo.length == 0 || data.audioOutputInfo.length == 0) {
            $('.vdo_btn_l').show()
        } else {
            $('.vdo_btn_l').hide()
        }
        function bindPlayer(data, $box, strTip) {

            var str = ''
            var ul = $box.find('.vdo_drop_list')

            if (data && data.length > 0) {

                ul.empty()
                str += `<li title="Windows默认设备">Windows默认设备</li>`
                for (var i = 0; i < data.length; i++) {

                    var curli = data[i];
                    str += `<li title="${curli.devName}" >${curli.devName}</li>`

                }
                str += `<li title="禁用" class="disabled">禁用</li>`
                ul.append(str);
            } else {
                ul.empty()

                $box.find('span').html(strTip)
                $box.find('.vdo_drop_ModifyThe').addClass('vdo_drop_MNo')

            }
        }

        $('.vdo_drop_list  li').click(function (e) {
            var $ele = $(this);
            var s_txt = $ele.text();

            var $parent = $ele.parent(".vdo_drop_list")
            $parent.hide();
            var parentPre = $parent.prev('.vdo_drop_ModifyThe')
            parentPre.removeClass("vdo_drop_aB")
            parentPre.find('span').html(s_txt)
            e.stopPropagation()

            var vdo_drop = $ele.parents('.vdo_drop')
            if (vdo_drop.hasClass('set1')) {//麦克风
                if ($ele.hasClass('disabled')) {
                    $('.vdo_btn_mic').removeClass('on').addClass('no')
                    $('.vdo_btn_l').show()
                } else {
                    $('.vdo_btn_mic').removeClass('no')
                }
            } else if (vdo_drop.hasClass('set2')) {//摄像头
                if ($ele.hasClass('disabled')) {
                    $('.vdo_btn_camera ').removeClass('on').addClass('no')
                    $('.vdo_btn_l').show()
                } else {
                    $('.vdo_btn_camera ').removeClass('no')
                }

            } else if (vdo_drop.hasClass('set3')) {//静音
                if ($ele.hasClass('disabled')) {
                    $('.vdo_btn_mute ').removeClass('on').addClass('no')
                    $('.vdo_btn_l').show()
                } else {
                    $('.vdo_btn_mute ').removeClass('no')
                }

            }




        })

    }


    // 点击切换左侧视频列表和主视频区域

    function changeVideo(ele) {

        var $ele = $(ele)
        var vdo_outL = $ele.find('.vdo_out');
        var vdo_outR = $('.vdo_r .vdo_out')
        var $main = vdo_outR.clone(true);
        var $vdo_L = vdo_outL.clone();
        $('.vdo_r ').prepend($vdo_L);
        $ele.append($main)
        vdo_outL.remove();
        vdo_outR.remove()

    }
    //打开登菊峰并打开本机的视频和音频设备
    function openMedia() {
        var parm = {}
        window.lxpc.exebusinessaction('VideoConf', 'GetJusToken', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {
            if (status == 0) {
                window.lxpc.exebusinessaction('VideoConf', 'LoginJusTalk', '0', jsondata, 0, function (status, jsondata, targ) {
                    if (status == 0) {
                       console.log(jsondata)

                        var data = JSON.parse(jsondata);
                        initData.ownerWnd = data.ownerWnd;
                        initData.peerWnd = data.peerWnd;
                        initData.videoId = (data.cameraInfo && data.cameraInfo.length > 0) ? data.cameraInfo[0].devId : null;
                        var ownVideo = document.querySelector('.vdo_l_video');
                        bindVideo(data.ownerWnd, ownVideo);
                        var vdo_me = $(ownVideo).parents('.vdo_out').addClass('mySelf').data('wnd', data.ownerWnd);

//打开视频和音频
                        playMedia(jsondata)
                        var data = JSON.parse(jsondata)
                        settinginfos=data
                        //绑定获取的可用设备
                        multimediaSeting(data)
                        if (data.audioOutputInfo && data.audioOutputInfo.length > 0) {
                            $('.vdo_invite_hint').hide();
                        } else {
                            $('.vdo_invite_hint').show();
                        }

                    }
                    else {
                        console.log(status)
                    }
                })
            }
            else {
                console.log(status)
            }
        })
    }
    //    1.	打开或关闭视频
    function ControlVideo(parm) {
        return new Promise(function (resolve, reject) {

            try {
                window.lxpc.exebusinessaction('VideoConf', 'ControlVideo', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {

                    if (status == 0) {

                        resolve(status)
                    } else {
                        reject(null)
                    }
                })
            } catch (e) {
                reject(null)
                console.log(e.message)
            }

        })
    }


    //    1.	2.	打开或关闭音频，调整音量
    function ControlAudio(parm) {
        return new Promise(function (resolve, reject) {
//        var parm={action:stop/start/volume”, ”audioInputId”:"",volumePercent:0-100}
            try {
                window.lxpc.exebusinessaction('VideoConf', 'ControlAudio', '0', JSON.stringify(parm), 0, function (status, jsondata, targ) {

                    if (status == 0) {

                        resolve(status)
                    } else {
                        reject(null)
                    }
                })
            } catch (e) {
                reject(null)
                console.log(e.message)
            }

        })
    }
    //查询人员信息详情
    function QuerySenderInfo(parm, targ) {
        return new Promise(function (resolve, reject) {
            try {

                window.lxpc.exebusinessaction('ChatRecord', 'QuerySenderInfo', '1', JSON.stringify(parm), targ, function (status, result, targ) {
                    if (status == 0) {

                        var result = {info: JSON.parse(result), index: targ}
                        resolve(result)

                    } else {
                        console.log(status)
                        reject(status)
                    }

                })
            } catch (e) {
                reject(e.message)
                console.log(e.message)
            }
        })

    }

    //退出
    function TerminateVideoConf() {
//        参数：｛“sessionId”:XXXXXX｝
        if (initData.sessionId) {
            var parm = {sessionId: initData.sessionId}

            try {

                window.lxpc.exebusinessaction('VideoConf', 'TerminateVideoConf', '0', JSON.stringify(parm), 0, function (status, result, targ) {

                    if (status == 0) {

                        window.lxpc.closewnd();

                    } else {
                        my_layer({message: '错误码' + status}, 'error')
                    }

                })
            } catch (e) {
                my_layer({message: '错误码' + e.message}, 'error')
                console.log(e.message)
            }
        } else {
            window.lxpc.closewnd();

        }

    }
    //2．	接收状态回调

    function ReceiveVideoConfStatus() {
        try {

            window.lxpc.exebusinessaction('VideoConf', 'ReceiveVideoConfStatus', '0', JSON.stringify({}), 0, function (status, jsondata, targ) {

                if (status == 0) {

                    var filter = '.wnd_' + initData.peerWnd,
                            $filter = $(filter),
                            vdo_l_bac = $filter.find('.vdo_l_bac'),
                            video = $filter.find('video');
                    var data = JSON.parse(jsondata)
                    if (data.statusName == 'MtcCallTermedNotification') {//对方断开断开
                        vdo_l_bac.show().find('.vdo_tip').html('通话已结束');
                        video.hide();

                        window.URL.revokeObjectURL(video.attr('src')); // 清除释放
//                        setTimeout(function () {
//                            window.lxpc.closewnd();
//                        }, 1000)


                    } else {
                        if (data.statusParam.MtcCallVideoStatusKey == 0x636F6666) {//关闭摄像头

                            vdo_l_bac.show();
                            vdo_l_bac.find('.vdo_tip').html('语音中')
                            video.hide()
                        } else {
                            if (data.statusParam.MtcCallVideoStatusKey == 0x6E726D6C) {//正常

                                video.show()
                                vdo_l_bac.hide();

                            }
                        }
                    }


                } else {
                    my_layer({message: '错误码' + status}, 'error')
                }

            })
        } catch (e) {
            my_layer({message: '错误码' + e.message}, 'error')
            console.log(e.message)
        }
    }

    function getImge(parm, handle, targ) {
        return new Promise(function (resolve, reject) {
            try {

                window.lxpc.exebusinessaction('DownloadResource', handle, '0', JSON.stringify(parm), targ, function (status, result, targ) {

                    if (status == 0) {

                        if (result.indexOf('\\') > -1 || result.indexOf('/') > -1) {
                            var obj = {path: result, index: targ}
                            resolve(obj)
                        }


                    } else {

                        reject(result, targ);
                        console.log(status)
                    }

                })
            }
            catch (e) {
                my_layer({message: '调用接口出错，错误码' + e.message}, 'error')
                reject(result, targ)
                console.log(e.message)
            }
        })
    }
    //初始化设置

    function initSetting() {

        initData.memberList = [];
        $('vdo_lD').data('index', 0)

        var parm = {userUniId: initData.dialogId, dialogType: 2, orgDomain: initData.orgDomain};
        senderId += 1

        QuerySenderInfo(parm, senderId).then(function (result) {
            var data = result.info,
                    targ = result.index;

            if (Object.prototype.toString.call(data) == '[object Array]') {
                if (data.length > 0) {
                    initData.memberList = initData.memberList.concat(data)
                    var item = data[0];
                    var name = item.name,
                            branch = item.branchPath;

                    $('.main_branch').html(branch)
                    $('.main_name').html(name);
                    var parm = {resourceList: [{photoResId: item.photoResId}], size: 96}
                    imgList[targ] = $('.vdo_invite_t img')

                    var handle = 'HeaderImage'
                    getImge(parm, handle, targ).then(function (data) {
                        var targ = data.index
                        var $img = imgList[targ];
                        $img.attr('src', data.path).error(function () {
                            this.src = 'images/card_icon.png'
                        })


                    })

                }

            }

        })


    }

</script>